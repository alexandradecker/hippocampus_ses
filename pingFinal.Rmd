---
title: "Hippocampal anterior posterior volumes"
output: html_notebook
editor_options: 
  chunk_output_type: console
---

# question 1: How do anterior and posterior hippocampal volumes change
## are these changes related to memory in a large representative sample?

## are there any effects of SES?

```{r load packages}
rm(list = ls())
library(broom); library(lme4); library(lmerTest)
library(tidyverse); library(data.table); library(dtplyr); 
library(ggbeeswarm); library(mediation); library(ez); library(semTools)
library("lavaan")
source("https://raw.githubusercontent.com/hauselin/Rcode/master/detectOutliers.R")

setwd('/Users/alexandradecker/Dropbox/Research/Ping/data/')
source("https://raw.githubusercontent.com/hauselin/Rcode/master/summaryh.R")
#save.image("PingAnalysisImage_Dec27.RData")
#save.image("PingAnalysisImage_March30.RData")
#load("PingAnalysisImage_March30.RData")
#load("PingAnalysisImage_Dec27.RData")

#save.image("PingAnalysisImage_May5.RData")
load("PingAnalysisImage_May5.RData")
#write.csv(pingFull, file = "pingFull_April17.csv", row.names = FALSE)

```

* compute correlation coefficient between freesurfer and maget brain volumes

```{r}
library(irr)

pingSubset[, .(whole)]
#find hippocampus values
subset(pingSubset, select = grep("Hippocampus", names(pingSubset)))
pingFull[, .(volLHippocampus, MRI_subcort_vol.Left.Hippocampus)]
#create matrices to do ICC for left and right
toIccLeft <- pingFull[, .(volLHippocampus, left.hippo.whole)]
toIccRight <- pingFull[, .(volRHippocampus, right.hippo.whole)]
#create variable for FS whole hippo volume
pingFull[, volWholeHippoFS := volLHippocampus + volRHippocampus]

#compute whole hippo ICC matrix
toICCWhole <- pingFull[, .(volWholeHippoFS, hippo.Whole.Avg)]

#correlate whole MAGET hippo and freesurfer hippo
cor.test(toICCWhole$volWholeHippoFS, toICCWhole$hippo.Whole.Avg)
cor.test(toIccLeft$volLHippocampus, toIccLeft$left.hippo.whole)
cor.test(toIccRight$volRHippocampus, toIccRight$right.hippo.whole)

icc(toIccLeft, model = c("oneway"), type = c("consistency"), unit = "single") # report ICC
icc(toIccLeft, model = c("twoway"), type = c("consistency"), unit = "single")
icc(toIccLeft, model = c("twoway"), type = c("agreement"), unit = "single")

icc(toIccRight, model = c("oneway"), type = c("consistency"), unit = "single") #report ICC
icc(toIccRight, model = c("twoway"), type = c("consistency"), unit = "single")
icc(toIccRight, model = c("twoway"), type = c("agreement"), unit = "single")

icc(toICCWhole, model = c("oneway"), type = c("consistency"), unit = "single") #report ICC
icc(toICCWhole, model = c("twoway"), type = c("consistency"), unit = "single")
icc(toICCWhole, model = c("twoway"), type = c("agreement"), unit = "single")

pingSubset$hippo.Whole.Avg
pingSubset$right.hippo.whole
pingSubset$left.hippo.whole

```


```{r pingSubset}

pingFull

pingFull[, .N, by = Income]
pingFull[FDH_1_Hispanic_or_Latino == 'yes', ethnicity := 'hispanic']
pingFull[FDH_2_Asian == 'yes', ethnicity := 'Asian']
pingFull[FDH_2_Pacific_Islander == 'yes', ethnicity := 'PacificIslander']
pingFull[FDH_2_African_American == 'yes', ethnicity := 'AfricanAmerican']
pingFull[FDH_2_American_Indian == "yes", ethnicity := 'AmericanIndian']
pingFull[FDH_2_White == "yes", ethnicity := 'White']

pingFull$FDH_2_African_American

grep(names(pingFull), value = TRUE, pattern = "FDH_")



pingFull[!is.na(Income), .N, by = .(ethnicity, Income)]%>%
  arrange(ethnicity)

pingSubset[, .N, by = .(AgeC)]
pingSubset[AgeC <0, .(AgeC)]

pingSubset[, .N, by = ethnicity]


```

```{r make ratio variables}
### making ratio variables ####
pingFull[, right.ratioAntPostNew := right.headNew/right.tailNew]
pingFull[, right.ratioAntPost := right.head/right.tail]
pingFull[, left.ratioAntPostNew := left.headNew/left.tailNew]
pingFull[, left.ratioAntPost := left.head/left.tail]
pingFull[, right.ratioAntWholeNew := right.headNew/right.hippo.wholeNew]
pingFull[, right.ratioAntWhole := right.head/right.hippo.whole]
pingFull[, left.ratioAntWholeNew := left.headNew/left.hippo.wholeNew]
pingFull[, left.ratioAntWhole := left.head/left.hippo.whole]
pingFull[, left.ratioPostWholeNew := left.tailNew/left.hippo.wholeNew]
pingFull[, right.ratioPostWholeNew := right.tailNew/right.hippo.wholeNew]
pingFull[, left.ratioPostWhole := left.tail/left.hippo.whole]
pingFull[, right.ratioPostWhole := right.tail/right.hippo.whole]
pingFull[, .(left.ratioAntPost, left.head, left.tail)]

```

#Remove outliers

```{r remove outliers}

#### clean data - remove outliers 
source("https://raw.githubusercontent.com/hauselin/Rcode/master/detectOutliers.R")

#hippocampus related outliers
pingFull[!is.na(left.hippo.wholeNew), left.hippo.wholeNewRO := outliersZ(left.hippo.wholeNew, zCutOff = 3)]
pingFull[!is.na(right.hippo.wholeNew), right.hippo.wholeNewRO :=outliersZ(right.hippo.wholeNew, zCutOff = 3)]
pingFull[!is.na(hippo.Whole.Avg), hippo.Whole.AvgRO := outliersZ(hippo.Whole.Avg, zCutOff = 3)]
pingFull[!is.na(right.headNew), right.headNewRO := outliersZ(right.headNew, zCutOff = 3)]
pingFull[!is.na(left.headNew), left.headNewRO := outliersZ(left.headNew, zCutOff = 3)]
pingFull[!is.na(right.tailNew), right.tailNewRO := outliersZ(right.tailNew, zCutOff = 3)]
pingFull[!is.na(left.tailNew), left.tailNewRO := outliersZ(left.tailNew, zCutOff = 3)]
pingFull[!is.na(ratioAntPostCombinedNew), ratioAntPostCombinedNewRO := outliersZ(ratioAntPostCombinedNew, zCutOff = 3)]


pingFull[!is.na(hippo.Whole.Avg) & is.na(hippo.Whole.AvgRO), Age]

#uncorrected hippocampus related outliers
pingFull[!is.na(left.hippo.whole), left.hippo.wholeRO := outliersZ(left.hippo.whole, zCutOff = 3)]
pingFull[!is.na(right.hippo.whole), right.hippo.wholeRO :=outliersZ(right.hippo.whole, zCutOff = 3)]
pingFull[, WholeHippoNC := right.hippo.whole + left.hippo.whole]
pingFull[!is.na(WholeHippoNC), WholeHippoNCRO := outliersZ(WholeHippoNC, zCutOff = 3)]
pingFull[!is.na(right.head), right.headRO := outliersZ(right.head, zCutOff = 3)]
pingFull[!is.na(left.head), left.headRO := outliersZ(left.head, zCutOff = 3)]
pingFull[!is.na(right.tail), right.tailRO := outliersZ(right.tail, zCutOff = 3)]
pingFull[!is.na(left.tail), left.tailRO := outliersZ(left.tail, zCutOff = 3)]
pingFull[!is.na(ratioAntPostCombined), ratioAntPostCombinedRO := outliersZ(ratioAntPostCombined, zCutOff = 3)]

```


#How do hippocampal volumes (whole) change with age?

In generally, we see a r of about 0.3; the relationship is stronger as income decreases

The relationship is quadratic rather than linear or cubic

* no significant effects of gender or gender interactions 

* lower income have smaller hippocampal volumes than higher income

* differences are attenuated in early adulthood

* in sum, quadratic relatipnship with age is significant and best fits data; no effects or interactions with gender;  there's an effect of low income when it's added as an interactin term, but no effect when added as a covariate only

```{r}
pingFull[!is.na(hippo.Whole.Avg), hippo.Whole.AvgRO := outliersZ(hippo.Whole.Avg, zCutOff = 3)]
pingFull[!is.na(ratioAntPostCombinedRO), ratioAntPostCombinedRO := outliersZ(ratioAntPostCombinedRO, zCutOff = 3)]

pingFull[!is.na(hippo.Whole.Avg) & is.na(hippo.Whole.AvgRO), .(hippo.Whole.Avg, hippo.Whole.AvgRO)]

ratioAntPostCombinedRO
dim(longWhole)
gender <- pingFull[, .(ID, GenderEC, Gender)]
longWhole <- left_join(longWhole, gender)


m1 <- lm(hippo.Whole.AvgRO ~ AgeC + Gender + Income, data = pingFull)

m2 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + GenderEC + Income, data = pingFull[!is.na(Income)])

m3 <- lm(hippo.Whole.AvgRO ~ AgeC * Gender + Income, data = pingFull)

m4 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + GenderEC, data = pingFull)
m4 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + GenderDC, data = pingFull)

summaryh(m4)
pingFull[, .(Gender, GenderEC, GenderDC)]


anova(m4, m2)

m3 <- lm(hippo.Whole.AvgRO ~ Age1 * Gender, data = pingFull)
m4 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 * Gender, data = pingFull)



anova(m1,m2)

m1 <- lmer(volume ~ AgeC * hemisphere + (1|ID), data = longWhole)
summary(m1)

m1 <- lm(right.hippo.wholeNewRO ~ Age1 + Gender, data = pingFull)
m2 <- lm(left.hippo.wholeNewRO ~ Age1 + Gender, data = pingFull)
summary(m1)
summary(m2)





library(ez)
m1 <- ezANOVA(longWhole, dv = volume, wid = ID, within = hemisphere, between = AgeC)

pingFull[!is.na(hippo.Whole.AvgRO), .N]

summaryh(m2)
summary(m4)
summaryh(m1)



m1 <- lm(hippo.Whole.Avg ~ AgeC + Age2* Gender, data = pingFull)
m2 <- lm(hippo.Whole.Avg ~ AgeC + Age2+ Gender, data = pingFull)

anova(m1, m2)
AIC(m1)
AIC(m2)



m1 <- lm(WholeHippoNCRO ~ Age1 + Gender, data = pingFull)
m2 <- lm(WholeHippoNCRO ~ Age1 + Age2 + GenderEC, data = pingFull)
m3 <- lm(WholeHippoNCRO ~ Age1 * Gender, data = pingFull)
m4 <- lm(WholeHippoNCRO ~ Age1 + Age2 * Gender, data = pingFull)


anova(m1, m2)
summaryh(m2)
summary(m4)

pingSubset$hippo.Whole.Avg
pingSubset[, .(left.hippo.wholeNew, right.hippo.wholeNew, hippo.Whole.Avg)]
pingSubset[, hippo.Whole.Sum.New := left.hippo.wholeNew+right.hippo.wholeNew]
pingSubset[, .(hippo.Whole.Sum.New, hippo.Whole.Avg)]

AIC(m1)
AIC(m2)
AIC(m4)
AIC(m5)

pingFull[!is.na(hippo.Whole.Avg), .N]

#only until 18
m1 <- lm(hippo.Whole.Avg ~ AgeC + Gender, data = pingSubset[Age < 18])
m2 <- lm(hippo.Whole.Avg ~ Age1 + Age2+ Gender, data = pingSubset[Age < 18])
m4 <- lm(hippo.Whole.Avg ~ AgeC * Gender, data = pingSubset[Age < 18])
m5 <- lm(hippo.Whole.Avg ~ Age1 + Age2 * Gender, data = pingSubset[Age < 18])

anova(m2, m5)
summary(m2)
summary(m5)


summaryh(lm(hippo.Whole.AvgRO ~ Age1 + Age2 + income  + educationYears, data = pingFull ))

summary(m1)


model <- lmer(weight ~ Time * Diet  + (1 + Time | Chick), data = ChickWeight)
summary(model)
summaryh(model, decimal = 4, showTable = T, showEffectSizesTable = T) # optional arguments


summary(lm(hippo.Whole.Avg ~ Age1 + Age2 + Gender, data = pingFull))

#income
summary(lm(hippo.Whole.Avg ~ AgeC + Age2 + Income + Gender , data = pingSubset))
summary(lm(hippo.Whole.Avg ~ AgeC + Age2 * Income + Gender, data = pingSubset))
summary(lm(hippo.Whole.Avg ~ AgeC + Age2 *  Gender, data = pingSubset))

es(r = .11)

#model testing
m1 <- lm(hippo.Whole.Avg ~ AgeC + Age2 * Income +  Gender, data = pingSubset) #more significant 
m2 <- lm(hippo.Whole.Avg ~ AgeC + Age2 + Income + Gender, data = pingSubset)
AIC(m1)
AIC(m2)

summary(m1) 
summary(m2)
pingFull$hippo.Whole.AvgRO
ggplot(pingSubset[], aes(Age, hippo.Whole.Avg)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
  labs(y = "Whole hippocampal volumes (mm ^3)") + 
  geom_rect(ymin = 4500, ymax = 5000, xmax = 14.5, xmin = 12.5, fill = alpha("black",0)) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

ggsave(file = 'wholeHippoAge.png', width = 5, height = 4)
  
ggplot(pingFull, aes(Age, WholeHippoNCRO, col = Gender)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
  labs(y = "Whole hippocampal volume \n without ICV correction") + 
  #geom_rect(ymin = 4500, ymax = 5000, xmax = 14.5, xmin = 12.5, fill = alpha("black",0)) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

ggplot(pingSubset[!is.na(Income)], aes(Age, hippo.Whole.Avg, col = Income)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
  labs(y = "Whole hippocampal volume") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

# are the slopes actually different?

```

Whole hippocampal volume analysis: Quadratic relatipnship best fits age related shifts in whole hippocampal volumes

* including parental income in the model makes it better

* differences between males and females are greater earlier in development compared to later in development


```{r whole hippocampal volume analyses}


reportLM(lm(left.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "White" & Income == "medium"]))
reportLM(lm(left.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "White" & Income == "low"]))

reportLM(lm(left.hippo.wholeNew ~ Age, data = pingSubset[Income == "high"]))
reportLM(lm(left.hippo.wholeNew ~ Age, data = pingSubset[Income == "medium"]))
reportLM(lm(left.hippo.wholeNew ~ Age, data = pingSubset[Income == "low"]))

reportLM(lm(left.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "AfricanAmerican"]))
reportLM(lm(left.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "AmericanIndian"]))
reportLM(lm(left.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "Asian"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "White" & Income == "high"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "White" & Income == "medium"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "White" & Income == "low"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[Income == "high"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[Income == "medium"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[Income == "low"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "AfricanAmerican"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "AmericanIndian"]))
reportLM(lm(right.hippo.wholeNew ~ Age, data = pingSubset[ethnicity == "Asian"]))

```



Okay, effect size for hippocampus as a function of age is about 0.3. What are the sample sizes like in existing papers?

```{r}

pwr.r.test(power = 0.8, sig.level = 0.05, r = 0.1)

pwr.p.test(h = ES.h(p1 = 0.75, p2 = 0.50), 
           sig.level = 0.05, 
           power = 0.80, 
           alternative = "greater")

```

#How do head volumes change with age?

* quadratic relationship best fits changes in hippocampal head

* no effect of gender on volume of hippocampal head

* low income have smallest volumes in hippocampal head, but no interactions

* best model is one with income; when we add income we see low income is significant predictor of volumes and differs from high income groups.

* Positive linear increase in hippocampal head in all groups; low incomes have smallest hpc heads

```{r age related shifts in hippocampal head}

pingFull[, combinedHeadNew := right.headNew + left.headNew]
pingFull[!is.na(combinedHeadNew), combinedHeadNewRO := outliersZ(combinedHeadNew, zCutOff = 3)]


m1 <-lm(combinedHeadNewRO ~ AgeC + GenderEC, data = pingFull[!is.na(Income)]) 
m1b <- lm(combinedHeadNewRO ~ AgeC + GenderDC + Income, data = pingFull) 
pingFull$Income <- relevel(pingFull$Income, ref = "medium")
summary(m1b)

m1b2 <- lm(combinedPosteriorNewRO ~ AgeC + GenderEC, data = pingFull) 
summary(m1b2)

m2 <- lm(combinedHeadNewRO ~(Age1 + Age2)+ GenderEC+ Income, data = pingFull[!is.na(Income)]) # best model
summaryh(m2)
m3 <- lm(combinedHeadNewRO ~(Age1 + Age2)+ GenderEC, data = pingFull) # best model

summaryh(anova(m2, m3))





m3 <-lm(combinedHeadNewRO ~ AgeC * GenderEC+ Income, data = pingFull) 
m4 <- lm(combinedHeadNewRO ~ (AgeC + Age2)* GenderEC+ Income, data = pingFull[!is.na(Income)])
anova(m1,m4)

summaryh(m2)
m3 <- lm(combinedHeadNewRO ~ AgeC + Age2 + I(Age1^3)+ GenderEC, data = pingFull)
m4 <-lm(combinedHeadNewRO ~ AgeC * GenderEC, data = pingFull)
m5 <- lm(combinedHeadNewRO ~ AgeC * Age2+ GenderEC, data = pingFull)
m6 <- lm(combinedHeadNewRO ~ AgeC * Age2 + I(Age1^3)+ GenderEC, data = pingFull)

anova(m1,m2)

summaryh(m1)

summary(m2)

summary(m3)

#what if we don't correct for ICV?

pingFull[, combinedHead := right.head + left.head]
pingFull[!is.na(combinedHead), combinedHeadRO := outliersZ(combinedHead, zCutOff = 3)]

m1 <-lm(combinedHeadRO ~ AgeC + Gender, data = pingFull) 
m2 <- lm(combinedHeadRO ~ AgeC + Age2+ GenderEC, data = pingFull) # best model
m3 <- lm(combinedHeadRO ~ AgeC + Age2 + I(Age1^3)+ Gender, data = pingFull)
m4 <-lm(combinedHeadRO ~ AgeC * Gender, data = pingFull)
m5 <- lm(combinedHeadRO ~ AgeC * Age2+ Gender, data = pingFull)
m6 <- lm(combinedHeadRO ~ AgeC * Age2 + I(Age1^3)+ Gender, data = pingFull)
anova(m2,m1)

summaryh(m1)
summaryh(m2)
summary(m3)


#what about income?
m1 <- lm(combinedHeadNewRO ~ AgeC + GenderDC + Income, data = pingFull) # best model
summaryh(m1)

AIC(m1)
AIC(m2)
AIC(m3)

summary(lm(combinedHeadNew ~ Age1 + Gender + Income, data = pingSubset)) # best model


#figures for paper

whole <- ggplot(pingFull, aes(Age, hippo.Whole.AvgRO, col = Gender)) +
  geom_point(alpha = 0.2) + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
  labs(y = "Whole hippocampal \nvolumes (mm^3)") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 


m1 <- lm(hippo.Whole.AvgRO ~ Age1 + income + GenderEC, pingFull)
m2 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + income + GenderEC, pingFull)
anova(m1, m2)

anterior <- ggplot(pingFull, aes(Age, combinedHeadNewRO, col = Gender)) +
  geom_point(alpha = 0.2) + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Anterior hippocampal \nvolumes (mm^3)") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

m3 <- lm(combinedHeadNewRO ~ Age1 + income + GenderEC, pingFull)
m4 <- lm(combinedHeadNewRO ~ Age1 + Age2 + income + GenderEC, pingFull)
anova(m3, m4)


posterior <- ggplot(pingFull, aes(Age, combinedPosteriorNewRO, col = Gender)) +
  geom_point(alpha = 0.2) + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Posterior hippocampal \nvolumes (mm^3)") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 


m5 <- lm(combinedPosteriorNewRO ~ Age1 + income + GenderEC, pingFull)
m6 <- lm(combinedPosteriorNewRO ~ Age1 + Age2 + income + GenderEC, pingFull)
anova(m5, m6)


ratio <- ggplot(pingFull, aes(Age, ratioAntPostCombinedNewRO, col = Gender)) +
  geom_point(alpha = 0.2) + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "hAnt/hPost hippocampal \nvolume ratios (mm^3)") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 


m7 <- lm(ratioAntPostCombinedNewRO ~ Age1 + income + GenderEC, pingFull)
m8 <- lm(ratioAntPostCombinedNewRO ~ Age1 + Age2 + income + GenderEC, pingFull)
anova(m7, m8)

plot_grid(anterior, posterior, whole, ratio, labels = c('A', 'B', "C", "D"),align = "hv")
  
plot_grid
library("cowplot")

ratioVols



ggplot(pingFull, aes(Age, combinedHead, col = Gender)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~x, se = TRUE) +
  labs(y = "Hippocampal head") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 


ggsave(file = 'HeadHippoAge.png', width = 5, height = 4)


ggplot(pingFull[!is.na(income)], aes(Age, combinedHeadNewRO, col = income2)) +
  #geom_point(alpha = .2) + 
  stat_smooth(method = 'lm', formula = y ~ x, se = FALSE) +
  labs(y = "Anterior hippocampus volume (mm^3)") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


#figure with age residualized from anterior hippocampus
pingFull[!is.na(combinedHeadNewRO), combinedHeadNewRO_residualized := residuals(lm(combinedHeadNewRO ~ AgeC))]




ggplot(pingFull[!is.na(Income)], aes(Income, combinedHeadNewRO_residualized, col = Income)) +
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6)+
  labs(y = "Anterior hippocampus volume \n(mm^3; residualized for age)") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

```


#How do posterior volumes change with age?

* best model is one that is linear and has gender as a covariate not interaction term

* steep age related positive increase in posterior hippocampal volume

* no significant effect of gender on posterior hippocampus

* no significant effect of income on posterior hippocampus

```{r effects of age on posterior hippocampus}

pingFull[, combinedPosteriorNew := right.tailNew + left.tailNew]
pingFull[!is.na(combinedPosteriorNew), combinedPosteriorNewRO := outliersZ(combinedPosteriorNew, zCutOff = 3)]

m1 <-lm(combinedPosteriorNewRO ~ AgeC + GenderEC, data = pingFull[!is.na(Income)]) # best model fit
m1b <-lm(combinedPosteriorNewRO ~ AgeC + GenderEC + Income, data = pingFull) # best model fit
anova(m1, m1b)



m2 <- lm(combinedPosteriorNewRO ~ AgeC + Age2+ GenderEC, data = pingFull)
m4 <-lm(combinedPosteriorNewRO ~ AgeC * GenderEC, data = pingFull)
m5 <- lm(combinedPosteriorNewRO ~ AgeC + Age2* GenderEC, data = pingFull)

anova(m1,m2)
summaryh(m1)
summary(m2)



summaryh(m2)


#uncorrected volumes

pingFull[, combinedPosterior := right.tail + left.tail]
pingFull[!is.na(combinedPosterior), combinedPosteriorRO := outliersZ(combinedPosterior, zCutOff = 3)]

m1 <-lm(combinedPosteriorRO ~ AgeC + GenderEC, data = pingFull[!is.na(Income)])
m1b <-lm(combinedPosteriorRO ~ AgeC + GenderEC + Income, data = pingFull[!is.na(Income)])
anova(m1, m1b)


# best model fit
m2 <- lm(combinedPosteriorRO ~ AgeC + Age2+ GenderEC, data = pingFull)
m3 <- lm(combinedPosteriorRO ~ AgeC + Age2 + I(Age1^3)+ GenderEC, data = pingFull)
m4 <-lm(combinedPosteriorRO ~ AgeC * GenderEC, data = pingFull)
m5 <- lm(combinedPosteriorRO ~ AgeC + Age2* GenderEC, data = pingFull)
m6 <- lm(combinedPosteriorRO ~ AgeC + Age2 + I(Age1^3)* GenderEC, data = pingFull)


pingFull[!is.na(combinedHeadNewRO) & !is.na(Income),]



anova(m2,m1)
summaryh(m1)
summaryh(m2)

#what about income?
#now add income
m2 <- lm(combinedPosteriorNew ~ AgeC + Gender * Income, data = pingSubset) # best model
m3 <- lm(combinedPosteriorNew ~ AgeC + Gender + Income, data = pingSubset) # best model
AIC(m2)
AIC(m3)

summary(lm(combinedPosteriorNew ~ Age1 + Gender + Income, data = pingSubset)) # best model
summary(lm(combinedPosteriorNew ~ Age1 + Gender * Income, data = pingSubset)) # best model



ggplot(pingSubset, aes(Age, combinedPosteriorNew, col = Gender)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
  labs(y = "Hippocampal posterior") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 




ggsave(file = 'HeadHippoAge.png', width = 5, height = 4)

ggplot(pingSubset[!is.na(Income)], aes(Age, combinedPosteriorNew, col = Income)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "posterior hippocampus") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

```

#how do ant/post volume ratios change with age? 

* significant effect of gender and age

* best model fit is the one that has gender and age linear changes

* as age increases, anterior volume decreases, but small effect so not very meaningful

* large effect of gender such that relative to posterior volumes, males have larger anterior volumes than females

* low income have different developmental trajectories compared to medium and high income families

* no effect of age on ant:post ratios in low income, but anterior gets smaller in medium/high income kids

* no effect of age on low, but effect of age on medium and high incomes

```{r plotting anterior and posterior volumes in same plot}

Wide <- pingFull[!is.na(left.headNewRO) & !is.na(right.headNew), .(ID, left.headNewRO, right.headNewRO, left.tailNewRO, right.tailNewRO, AgeC)]
longhead <- gather(Wide, region, volume, -c(ID, AgeC))%>%
  arrange(ID)
setDT(longhead)
longhead[region %in% c("right.tailNewRO", "right.headNewRO"), hemisphere := "right"]
longhead[region %in% c("left.tailNewRO", "left.headNewRO"), hemisphere := "left"]

longhead[region %in% c("left.headNewRO", "right.headNewRO"), region  := "head"]
longhead[region %in% c("right.tailNewRO", "left.tailNewRO"), region  := "tail"]


WideWhole <- pingFull[!is.na(left.hippo.wholeRO) & !is.na(right.hippo.wholeRO), .(ID, right.hippo.wholeRO, left.hippo.wholeRO, AgeC)]
longWhole <- gather(WideWhole, region, volume, -c(ID, AgeC))%>%
  arrange(ID)
setDT(longWhole)
longWhole[region %in% c("right.hippo.wholeRO"), hemisphere := "right"]
longWhole[region %in% c("left.hippo.wholeRO"), hemisphere := "left"]

longWhole[region %in% c("right.hippo.wholeRO", "left.hippo.wholeRO"), region  := "whole"]



left.hippo.wholeRO
hippo.Whole.Avg

Wide <- pingFull[!is.na(left.headNewRO) & !is.na(right.headNew), .(ID, left.headNewRO, right.headNewRO, left.tailNewRO, right.tailNewRO, AgeC)]
longhead <- gather(Wide, region, volume, -c(ID, AgeC))%>%
  arrange(ID)
setDT(longhead)
longhead[region %in% c("right.tailNewRO", "right.headNewRO"), hemisphere := "right"]
longhead[region %in% c("left.tailNewRO", "left.headNewRO"), hemisphere := "left"]

longhead[region %in% c("left.headNewRO", "right.headNewRO"), region  := "head"]
longhead[region %in% c("right.tailNewRO", "left.tailNewRO"), region  := "tail"]

toConvertAntPost <- pingFull[, .(ID, Age, AgeC, Age1, Age2, Gender, Income, combinedPosteriorNewRO, combinedHeadNewRO)]
AntPostSlopes <- gather(toConvertAntPost, region, volume, -c(ID, Gender, Age,  AgeC, Age1, Age2, Income))%>%arrange(ID)
AntPostSlopes <- tbl_dt(AntPostSlopes)
AntPostSlopes <- AntPostSlopes[!is.na(volume)]
memoryMeasures <- pingFull[, .(ID, TBX_lsRO, TBX_ibam_scrRO, TBX_VOCAB_THETA)]
left_join(AntPostSlopes, memoryMeasures)

pingFull[!is.na(ratioAntPostCombinedNewRO), .N]
pingFull[!is.na(ratioAntPostCombinedRO), .N]





m1 <- lm(ratioAntPostCombinedNewRO ~ AgeC + GenderEC, data =  pingFull[!is.na(Income)])
m1b <- lm(ratioAntPostCombinedNewRO ~ AgeC + GenderDC + Income, data =  pingFull[!is.na(Income)])
anova(m1, m1b)

summaryh(m1b)


pingFull$Income <- relevel(pingFull$Income, ref = "low")
pingFull$Income <- relevel(pingFull$Income, ref = "medium")

summaryh(m1b)

summary(lmer(volume ~  region * AgeC + (1|ID), data = AntPostSlopes))
summary(lmer(volume ~  logIncome3 : region + AgeC + (1|ID), data = AntPostSlopes))

summary(lmer(volume ~  region * (Age1 + Age2) + (1|ID), data = AntPostSlopes))
BIC(m1)

m1 <- lmer(volume ~  region * AgeC + (1|ID), data = AntPostSlopes)
summaryh(m1)

m2 <- lmer(volume ~  region * (Age1 + Age2) + (1|ID), data = AntPostSlopes)

anova(m1, m2)


AntPostSlopes <- left_join(AntPostSlopes, toMerge)
toMerge <- pingFull[, .(ID, logIncome3, GenderDC, DeviceSerialNumber)]

#mixed.ANOVA <- aov(volume ~  region * Age1 + region * Age2 + Error(ID/region ), data=AntPostSlopes )
#summary( mixed.ANOVA )



ratioVols <- ggplot(AntPostSlopes, aes(Age, volume, col = region)) +
  #geom_point(alpha = 0.01, size = 3) + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Anterior and Posterior volumes", col = "region", title = " ") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))+
  scale_color_manual(labels = c("Anterior hippocampus", "Posterior hippocampus"),
    values = c("maroon", "dark blue"))
  
  ratioVols

longFormRepeatedMeasures <- pingFull[, .(ID, Age, Age2, AgeC, GenderEC, Income, combinedPosteriorNewRO, combinedHeadNewRO, ratioAntPostCombinedRO, hippo.Whole.AvgRO)]
longRepeatMeasuresVol <- gather(longFormRepeatedMeasures, region, volume, -c(ID, Age, Age2, AgeC, GenderEC, Income))

longRepeatMeasuresVol%>%
  arrange(ID)%>%
  print(N=5)



```


```{r anterior and posterior hippocampal volume ratios}
pingFull[, ratioAntPostCombined := right.ratioAntPost + left.ratioAntPost]
pingFull[!is.na(ratioAntPostCombined), ratioAntPostCombinedRO := outliersZ(ratioAntPostCombined, zCutOff = 3)]

m1 <-lm(ratioAntPostCombinedRO ~ AgeC + GenderEC, data = pingFull) # best model
m2 <- lm(ratioAntPostCombinedRO ~ Age1 + Age2+ GenderEC, data = pingFull)
m3 <- lm(ratioAntPostCombinedRO ~ Age1 + Age2 + I(Age1^3)+ GenderEC, data = pingFull)
m4 <-lm(ratioAntPostCombinedRO ~ AgeC * GenderEC, data = pingFull)
m5 <- lm(ratioAntPostCombinedRO ~ Age1 * Age2+ GenderEC, data = pingFull)
m6 <- lm(ratioAntPostCombinedRO ~ Age1 * Age2 + I(Age1^3)+ GenderEC, data = pingFull)


anova(m1,m2)
summary(m1)
summaryh(m1)


#what about income?
#now add income
m2 <- lm(ratioAntPostCombined ~ AgeC + Gender * Income, data = pingSubset) # best model
m3 <- lm(ratioAntPostCombined ~ AgeC + Gender + Income, data = pingSubset) # best model
AIC(m2)
AIC(m3)

summary(lm(ratioAntPostCombined ~ Age1 + GenderEC + Income, data = pingFull)) # best model
pingFull$Income <- relevel(pingFull$Income, ref = "low")
summary(lm(ratioAntPostCombined ~ Age1 + Gender * Income, data = pingFull)) # best model

pingFull[, ratioAntPostCombinedNew := combinedHeadNewRO/combinedPosteriorNewRO]
pingFull[, ratioAntPostCombined := combinedHeadRO/combinedPosteriorRO]

pingFull[, combinedPosteriorRO]



ggplot(pingFull[!is.na(Income)], aes(Age, ratioAntPostCombined, col = Gender)) +
  #geom_point(alpha = 0.2) + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Anterior to posterior volume ratios") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

ggsave(file = 'HeadHippoAge.png', width = 5, height = 4)


ggplot(pingFull[!is.na(income)], aes(Age, ratioAntPostCombined, col = income)) +
  #geom_point(alpha = .2) + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Anterior/Posterior volume ratios") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))



pingFull[!is.na(income) & !is.na(ratioAntPostCombined), ratio_residualized := residuals(lm(ratioAntPostCombined ~ AgeC))]

pingFull[, .(income, educationYears)]
ggplot(pingFull[!is.na(income)], aes(educationYears, hippo.Whole.AvgRO_residuals, col = income)) +
  #geom_point(alpha = .2) + 
  labs(x = "years of parental education") +
  stat_smooth(formula = y ~ x, method = "lm")+
 stat_summary(fun.y = mean,
               fun.ymin = function(x) mean(x) - se(x), 
               fun.ymax = function(x) mean(x) + se(x), 
               geom = "pointrange") +   
  labs(y = "Whole hippocampal volumes \n residualized for age") + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

pingFull$hippo.Whole.AvgRO_residuals
```

#slopes anterior posterior age related change
Is there a difference slopes for anterior and posterior hippocampus?

```{r}
AntPostSlopes<- tbl_dt(AntPostSlopes)
AntPostSlopes[, mean(Age)]
names(AntPostSlopes)
AntPostSlopes[, Age2 := AgeC^2]

summary(lmer(measure ~  AgeC * variable + (1|ID), data = AntPostSlopes))

```



* How does memory change in our cohort across development?

```{r}

m1 <- lm(TBX_ibam_scr ~ Age1 , data = pingFull[!is.na(combinedHeadNew)])
m2 <- lm(TBX_ibam_scr ~ Age1 + Age2 , data = pingFull[!is.na(combinedHeadNew)]) # best model 


m3 <- lm(TBX_ibam_scr ~ Age1 * GenderEC, data = pingFull[!is.na(combinedHeadNew)])
m4 <- lm(TBX_ibam_scr ~ Age1 + Age2 * GenderEC, data = pingFull[!is.na(combinedHeadNew)])
anova(m1, m2)
summaryh(m2)
summary(m2)

names(pingFull)[1:100]

summary(lm())

grep(names(pingFull), value = TRUE, pattern = )

#test
m1 <- lm(ratioAntPostCombinedNewRO ~  MRI_cort_area.ctx.rh.inferiorparietal + AgeC , data = pingFull)
summary(m1)
anova(m1)

#select best model for episodic memory
m1 <- lm(TBX_ibam_scrRO ~ (Age1 + Age2) + Income + GenderEC, data = pingFull[!is.na(combinedHeadNewRO)& !is.na(Income)])

m1b <- lm(TBX_ibam_scrRO ~ (Age1 + Age2) + GenderEC, data = pingFull[!is.na(combinedHeadNewRO)& !is.na(Income)])

anova(m1, m1b)

summaryh(m1)


#select best model for working memory
m1 <- lm(TBX_lsRO ~ (Age1 + Age2) + Income + GenderEC, data = pingFull[!is.na(combinedHeadNewRO)& !is.na(Income)])

m1b <- lm(TBX_lsRO ~ (Age1 + Age2) + GenderEC, data = pingFull[!is.na(combinedHeadNewRO)& !is.na(Income)])

anova(m1, m1b)
summaryh(m1)

pingFull$Income <- relevel(pingFull$Income, ref = "high")



pingFull$TBX_VOCAB_THETA
#select best model for vocab
m1 <- lm(TBX_VOCAB_THETA ~ (Age1 + Age2) + Income + GenderEC, data = pingFull[!is.na(combinedHeadNewRO)& !is.na(Income)])
summaryh(m1)




summaryh(m1)
pingFull[, .(GenderEC, Gender)]

m1 <- lm(TBX_ls ~ Age1 + GenderEC, data = pingFull[!is.na(combinedHeadNew)])
m2 <- lm(TBX_ls ~ Age1 + Age2 + GenderEC, data = pingFull[!is.na(combinedHeadNew)]) # best model 
m3 <- lm(TBX_ls ~ Age1 * GenderEC, data = pingFull[!is.na(combinedHeadNew)])
m4 <- lm(TBX_ls ~ Age1 + Age2 * GenderEC, data = pingFull[!is.na(combinedHeadNew)])
anova(m3,m2)
summaryh(m2)

m1 <- lm(TBX_VOCAB_THETA ~ Age1 + GenderEC, data = pingFull[!is.na(combinedHeadNew)])
m2 <- lm(TBX_VOCAB_THETA ~ Age1 + Age2 + GenderEC + Income, data = pingFull[!is.na(combinedHeadNewRO)]) # best model 
m2b <- lm(TBX_VOCAB_THETA ~ Age1 + Age2 + GenderEC, data = pingFull) # best model 

m3 <- lm(TBX_VOCAB_THETA ~ Age1 * GenderEC, data = pingFull[!is.na(combinedHeadNew)])
m4 <- lm(TBX_VOCAB_THETA ~ Age1 + Age2 * GenderEC, data = pingFull[!is.na(combinedHeadNew)])
anova(m1,m2)
summaryh(m2)

m2 <- lm(TBX_VOCAB_THETA ~ Age1 + Age2 + GenderDC + Income, data = pingFull[!is.na(combinedHeadNewRO)]) # best model 
summaryh(m2)
summary(m2)

pingFull$Income <- relevel(pingFull$Income, ref = "high")

ps <- c(.01, 0.05, 0.04, 0.06)
p.adjust(p = ps, method = "fdr")

```



```{r}

ggplot(pingFull[!is.na(combinedHeadNew),], aes(Age, TBX_ibam_scr)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
  labs(y = "Episodic Memory score", x = "Age") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))
         
pingFull$TBX_VOCAB_THETA

```


#how do whole hpc corr memory?
* How do these volumes relate to memory?

* once we control for age, there is a very small relationship between whole hpc volumes and memory

* no effects of gender

```{r correlations between whole hippocampus and cognitive measures}

grep(names(pingFull), pattern = "Hippo", value = TRUE)

m2 <- lm(TBX_ibam_scr ~ combinedHeadNewRO+ Age1 + Age2, data = pingFull)
summaryh(m2)
summary(m2)

grep(names(pingFull), value = TRUE, pattern = "ratio")

m2 <- lm(TBX_ibam_ls ~ ratioAntPostCombinedRO, data = pingFull)
summaryh(m2)
anova(m2)

ps <- c(0.297, 0.007, .018, 0.009, 0.016, 0.00018)

ps <- c(0.009, 0.016, 0.00018)
p.adjust(ps, method = "fdr")


m1 <- lm(TBX_lsRO ~ ratioAntPostCombinedRO + Age1 + Age2, data = pingFull)
summaryh(m1)
anova(m1)

m1 <- lm(TBX_VOCAB_THETA ~ ratioAntPostCombinedRO * (Age1 + Age2), data = pingFull)
summaryh(m1)
anova(m1)


m1 <- lm(TBX_lsRO ~ hippo.Whole.AvgRO , data = pingFull)
summaryh(m1)
anova(m1)

m1 <- lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO + (Age1 + Age2), data = pingFull)
summaryh(m1)
anova(m1)

pingFull[!is.na(TBX_ibam_scr) & !is.na(combinedHeadNew), .N]
pingFull[!is.na(TBX_ls) & !is.na(combinedHeadNew), .N]
pingFull[!is.na(TBX_VOCAB_THETA) & !is.na(combinedHeadNew), .N]

pingFull[!is.na(combinedHeadNew), .N]


summarh(m2)
anova(m1,m2)

m1 <- lm(TBX_ibam_scrRO ~  (Age1+Age2) + hippo.Whole.Avg, data = pingFull[!is.na(Income)])
m2 <- lm(TBX_ibam_scrRO ~  hippo.Whole.Avg + (Age1+Age2) + Income, data = pingFull[!is.na(Income)])

summaryh(m1)

anova(m1)
anova(m1, m2)
summaryh(m2)

m1 <- lm(TBX_lsRO ~ AgeC, data = pingFull[!is.na(combinedHeadNewRO)])
m2 <- lm(TBX_lsRO ~ Age1 + Age2, data = pingFull[!is.na(combinedHeadNewRO)])
anova(m1, m2)


m1 <- lm(TBX_ibam_scrRO ~  combinedHeadNewRO + (Age1+Age2), data = pingFull)
summaryh(m1)

m1 <- lm(TBX_lsRO ~  hippo.Whole.Avg + GenderEC+ (Age1 + Age2), data = pingFull)
summaryh(m1)

m1 <- lm(TBX_VOCAB_THETA ~  hippo.Whole.Avg + GenderEC+ (Age1 + Age2) + Income, data = pingFull)
summaryh(m1)



m2 <- lm(TBX_lsRO ~  hippo.Whole.Avg + (Age1 + Age2) + Income , data = pingFull[!is.na(Income)])
anova(m1, m2)
summary(m1)


m1 <- lm(TBX_ls ~  hippo.Whole.Avg + (Age1 + Age2) + GenderEC + Income, data = pingFull)
m2 <- lm(TBX_ls ~  hippo.Whole.Avg + (Age1 + Age2) + GenderEC + Income, data = pingFull)


m1 <- lm(TBX_VOCAB_THETA ~  hippo.Whole.Avg + (Age1 + Age2) + GenderEC + Income, data = pingFull)
m2 <- lm(TBX_VOCAB_THETA ~  hippo.Whole.Avg + (Age1 + Age2) + GenderEC + Income, data = pingFull)
summaryh(m1)



summary(lm(TBX_ls ~  hippo.Whole.Avg * AgeC + I(AgeC^2) + Gender, data = pingSubset))
summary(lm(TBX_ls ~  left.hippo.wholeNew * AgeC + I(AgeC^2) + Gender, data = pingSubset))
summary(lm(TBX_ls ~  right.hippo.wholeNew * AgeC + I(AgeC^2) + Gender, data = pingSubset))
summary(lm(TBX_ls ~  right.headNew * AgeC + I(AgeC^2) + Gender, data = pingSubset))
summary(lm(TBX_ls ~  left.headNew * AgeC + I(AgeC^2) + Gender, data = pingSubset))
summary(lm(TBX_ibam_scr ~  right.headNew * AgeC + I(AgeC^2) + Gender, data = pingSubset))
summary(lm(TBX_ibam_scr ~  left.headNew * AgeC + I(AgeC^2) + Gender, data = pingSubset))

summary(lm(TBX_ls ~  right.headNew * Income + AgeC + I(AgeC^2) + Gender, data = pingSubset))
summary(lm(TBX_ls ~  left.headNew * Income + AgeC + I(AgeC^2) + Gender, data = pingSubset))


ggplot(pingSubset, aes(hippo.Whole.Avg, TBX_ibam_scr)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

m1 <- lm(TBX_ibam_scr ~ AgeC, data= pingSubset)
m2 <- lm(TBX_ibam_scr ~ AgeC + AgeC + I(AgeC^2), data= pingSubset)
summary(m1)
summary(m2)
anova(m1, m2)

pingSubset[!is.na(TBX_ibam_scr), residIbam := residuals(lm(TBX_ibam_scr ~ AgeC + I(AgeC^2), data= pingSubset[!is.na(TBX_ibam_scr)]))]


ggplot(pingSubset, aes(hippo.Whole.Avg, residIbam)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


#what about income? No interactions between Income and whole hippo 
m2 <- lm(TBX_ibam_scr ~ hippo.Whole.Avg + AgeC + I(AgeC^2) + Gender + Income, data = pingSubset)
m3 <- lm(TBX_ibam_scr ~ hippo.Whole.Avg * Income + AgeC + I(AgeC^2) + Gender , data = pingSubset)
anova(m2, m3)
summary(m2)
summary(m3)


ggplot(pingSubset, aes(hippo.Whole.Avg, residIbam, col = Income)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

```

*Does low income interact with the relationship between memory and volumes?

```{r}
inter <- lm(TBX_VOCAB_THETA ~ combinedHeadNewRO * Income, data = pingFull)
summary(inter)

grep(names(pingFull), pattern = "hippo", value=TRUE)


interb <- lm(TBX_ibam_scr ~ combinedHeadNewRO * Income + Age1 + Age2, data = pingFull[!is.na(Income)])
summary(interb)

pingFull$Income <- relevel(pingFull$Income, ref = "low")

ggplot(pingFull[!is.na(Income)], aes(hippo.Whole.AvgRO, TBX_ibam_scr, col = Income)) +
  stat_smooth(method = 'lm', formula  = y ~ x) 


ggplot(pingFull[!is.na(Income)], aes(combinedHeadNewRO, TBX_ls, col = Income)) +
  stat_smooth(method = 'lm', formula  = y ~ x) 


grep(names(pingFull), pattern = "residual", value = TRUE)




```


#how posterior corr memory?
* posterior volumes do not predict memory 

* age and income predicts memory

```{r effects of posterior volumes on memory }

m1 <- lm(TBX_ibam_scr ~ combinedPosteriorNew + AgeC + Gender, data = pingSubset)
m2 <- lm(TBX_ibam_scr ~ combinedPosteriorNew + AgeC + I(AgeC^2) + Gender, data = pingSubset)
anova(m1, m2)
summary(m1)
summary(m2)

ggplot(pingSubset, aes(combinedPosteriorNew, residIbam, col = Income)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


#what about income? No interactions between Income and head... 
m2 <- lm(TBX_ibam_scr ~ combinedPosteriorNew + AgeC + I(AgeC^2) + Gender + Income, data = pingSubset)
m3 <- lm(TBX_ibam_scr ~ combinedPosteriorNew * Income + AgeC + I(AgeC^2) + Gender , data = pingSubset)
anova(m2, m3)
summary(m2)
summary(m3)

ggplot(pingSubset, aes(combinedPosteriorNew, residIbam, col = Income)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


```
#how do ratios corr memory?

If you are from a lower income, having a larger hippo head is better for memory
otherwise, no effect of ratio on memory
* Could large head rescue some of the deficits caused by low income?

If don't residualize memory:
* larger anterior relative to posterior = worse memory in high income kids, but better memory in low income kids

```{r how do anterior volume ratios predict memory?}
pingSubset$ratioAntPostCombined

m2 <- lm(TBX_ibam_scr ~ ratioAntPostCombined, data = pingSubset)
m1 <- lm(TBX_ibam_scr ~ ratioAntPostCombined * AgeC + I(AgeC^2) + Gender, data = pingSubset)

anova(m1, m2)
summary(m1)
summary(m2)

ggplot(pingSubset, aes(ratioAntPostCombined, residIbam)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


#what about income? No interactions between Income and head... 
m2 <- lm(TBX_ibam_scr ~ ratioAntPostCombined + AgeC + I(AgeC^2) + Gender + Income, data = pingSubset)
m3 <- lm(TBX_ibam_scr ~ ratioAntPostCombined * Income + AgeC + I(AgeC^2) + Gender , data = pingSubset)
anova(m2, m3)
summary(m2)
summary(m3)

ggplot(pingSubset, aes(ratioAntPostCombined, residIbam, col = Income)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))



ggplot(pingSubset, aes(ratioAntPostCombined, TBX_ibam_scr, col = Income)) +
  geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


```



```{r}

memoryWide <- pingFull[, .(ID, Age, AgeC, Age1, Age2, GenderEC, ratioAntPostCombinedRO, combinedPosteriorNewRO, combinedHeadNewRO, TBX_ibam_scr, TBX_ls, TBX_VOCAB_THETA)]

memoryLong <- tbl_dt(gather(memoryWide, region, volume,  -c(ID, AgeC, Age, Age1, Age2, GenderEC, TBX_ibam_scr, TBX_ls, TBX_VOCAB_THETA)))
names(memoryLong)
memoryLong[region == "combinedPosteriorNewRO",]
summary(lmer(TBX_ibam_scr ~ region * AgeC * GenderEC + (1|ID), data = memoryLongDf[,region != "hippo.Whole.AvgRO"]))

memoryLongDf <- tbl_dt(memoryLongDf)

```

#volumes and memory


* first, remove outliers for memory 

```{r}

pingFull[Age > 5 & Age < 8, TBX_ibam_scrRO := outliersZ(TBX_ibam_scr, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 5 & Age < 8, .(TBX_ibam_scr, TBX_ibam_scrRO) ]%>%print(n=Inf)
pingFull[Age > 5 & Age < 8 & TBX_ibam_scr > 15, TBX_ibam_scrRO := TBX_ibam_scr]


pingFull[Age > 7.9 & Age < 12.9, TBX_ibam_scrRO := outliersZ(TBX_ibam_scr, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 7.9 & Age < 12.9, .(TBX_ibam_scr, TBX_ibam_scrRO) ]%>%print(n=Inf)
pingFull[Age > 7.9 & Age < 12.9 & TBX_ibam_scr > 30, TBX_ibam_scrRO := TBX_ibam_scr]


pingFull[Age > 12.99 & Age < 15, TBX_ibam_scrRO := outliersZ(TBX_ibam_scr, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 12.99& Age < 15, .(TBX_ibam_scr, TBX_ibam_scrRO) ]%>%print(n=Inf)
pingFull[Age   > 12.99& Age < 15 & TBX_ibam_scr > 30, TBX_ibam_scrRO := TBX_ibam_scr]



pingFull[Age > 15, TBX_ibam_scrRO := outliersZ(TBX_ibam_scr, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 15, .(TBX_ibam_scr, TBX_ibam_scrRO) ]%>%print(n=Inf)
pingFull[Age   >  15 & TBX_ibam_scr > 30, TBX_ibam_scrRO := TBX_ibam_scr]

```


*remove outliers for working memory 


```{r}
pingFull[Age <5, TBX_lsRO := outliersZ(TBX_ls, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age <5, .(TBX_ls, TBX_lsRO) ]%>%print(n=Inf)
pingFull[Age <5 & TBX_ls > 8, TBX_lsRO := TBX_ls]


pingFull[Age > 5 & Age < 8, TBX_lsRO := outliersZ(TBX_ls, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 5 & Age < 8, .(TBX_ls, TBX_lsRO) ]%>%print(n=Inf)
pingFull[Age > 5 & Age < 8 & TBX_ls > 10, TBX_lsRO := TBX_ls]


pingFull[Age > 7.9 & Age < 12.9, TBX_lsRO := outliersZ(TBX_ls, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 7.9 & Age < 12.9, .(TBX_ls, TBX_lsRO) ]%>%print(n=Inf)
pingFull[Age > 7.9 & Age < 12.9 & TBX_ls > 20, TBX_lsRO := TBX_ls]


pingFull[Age > 12.99 & Age < 15, TBX_lsRO := outliersZ(TBX_ls, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 12.99& Age < 15, .(TBX_ls, TBX_lsRO) ]%>%print(n=Inf)
pingFull[Age   > 12.99& Age < 15 & TBX_ls > 20, TBX_lsRO := TBX_ls]



pingFull[Age > 15, TBX_lsRO := outliersZ(TBX_ls, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 15, .(TBX_ls, TBX_lsRO) ]%>%print(n=Inf)
pingFull[Age   >  15 & TBX_ls > 20, TBX_lsRO := TBX_ls]

```

* now for vocab

```{r}
pingFull[Age <5, TBX_VOCAB_THETARO := outliersZ(TBX_VOCAB_THETA, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age <5, .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age <5 & is.na(TBX_VOCAB_THETARO), .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age <5 & TBX_VOCAB_THETA > 0, TBX_VOCAB_THETARO := TBX_VOCAB_THETA]




pingFull[Age > 5 & Age < 8, TBX_VOCAB_THETARO := outliersZ(TBX_VOCAB_THETA, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 5 & Age < 8, .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age > 5 & Age < 8 & is.na(TBX_VOCAB_THETARO), .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age > 5 & Age < 8 & TBX_VOCAB_THETA > 0, TBX_VOCAB_THETARO := TBX_VOCAB_THETA]


pingFull[Age > 7.9 & Age < 12.9, TBX_VOCAB_THETARO := outliersZ(TBX_VOCAB_THETA, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 7.9 & Age < 12.9, .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age > 5 & Age < 8 & is.na(TBX_VOCAB_THETARO), .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age > 7.9 & Age < 12.9 & TBX_VOCAB_THETA >0, TBX_VOCAB_THETARO := TBX_VOCAB_THETA]


pingFull[Age > 12.99 & Age < 15, TBX_VOCAB_THETARO := outliersZ(TBX_VOCAB_THETA, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 12.99 & Age < 15, .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age > 12.99 & Age < 15 & is.na(TBX_VOCAB_THETARO), .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age > 12.99 & Age < 15 & TBX_VOCAB_THETA > 0, TBX_VOCAB_THETARO := TBX_VOCAB_THETA]



pingFull[Age > 15, TBX_VOCAB_THETARO := outliersZ(TBX_VOCAB_THETA, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[Age > 15, .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age > 15 & is.na(TBX_VOCAB_THETARO), .(TBX_VOCAB_THETA, TBX_VOCAB_THETARO) ]%>%print(n=Inf)
pingFull[Age   >  15 & TBX_VOCAB_THETA > 0, TBX_VOCAB_THETARO := TBX_VOCAB_THETA]



```



```{r}

#episodic memory

#overall age
#episodic memory
pingFull[Age < 9, .(Age)]
summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO * AgeC, data = pingFull))
summaryh(lm(TBX_ibam_scrRO ~ right.headNewRO * AgeC, data = pingFull))
summaryh(lm(TBX_ibam_scrRO ~ left.headNewRO * AgeC, data = pingFull))

summary(lm(TBX_ibam_scrRO ~ combinedPosteriorNewRO+ (Age1 + Age2), data = pingFull))
summary(lm(TBX_ibam_scrRO ~ ratioAntPostCombinedRO+ AgeC, data = pingFull))
summary(lm(TBX_ibam_scrRO ~ hippo.Whole.AvgRO + (Age1 + Age2), data = pingFull))
summary(lm(TBX_ibam_scrRO ~ hippo.Whole.AvgRO + AgeC, data = pingFull))



#working memory
summary(lm(TBX_lsRO ~ combinedHeadNewRO + (Age1 + Age2), data = pingFull))
summary(lm(TBX_lsRO ~ combinedPosteriorNewRO+ (Age1 + Age2), data =pingFull))
summary(lm(TBX_lsRO ~ right.hippo.wholeNewRO + AgeC, data = pingFull))
summary(lm(TBX_lsRO ~ left.hippo.wholeNewRO + AgeC, data = pingFull))
summary(lm(TBX_lsRO ~ hippo.Whole.AvgRO * (Age1 + Age2), data = pingFull))
summaryh(lm(TBX_lsRO ~ hippo.Whole.AvgRO * AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ hippo.Whole.AvgRO * AgeC, data = pingFull))

summary(lm(TBX_lsRO ~ ratioAntPostCombinedRO+ (Age1 + Age2), data = pingFull)) #####


#vocab
summary(lm(TBX_VOCAB_THETARO ~ combinedHeadNewRO + (Age1 + Age2), data = pingFull))
summary(lm(TBX_VOCAB_THETARO ~ combinedPosteriorNewRO+ (Age1 + Age2), data = pingFull))
summary(lm(TBX_VOCAB_THETARO ~ hippo.Whole.AvgRO+ (Age1 + Age2), data = pingFull))
summary(lm(TBX_VOCAB_THETARO ~ ratioAntPostCombinedRO+ (Age1 + Age2), data = pingFull))


###########

#overall age
#episodic memory
pingFull[Age < 9, .(Age)]
summary(lm(TBX_ibam_scrRO ~ combinedHeadNewRO + AgeC, data = pingFull))
summary(lm(TBX_ibam_scrRO ~ combinedPosteriorNewRO* Income* AgeC, data = pingFull))
summary(lm(TBX_ibam_scrRO ~ hippo.Whole.AvgRO* Income* AgeC, data = pingFull))
summary(lm(TBX_ibam_scrRO ~ ratioAntPostCombinedRO* Income* AgeC, data = pingFull))

#working memory
summary(lm(TBX_lsRO~ combinedHeadNewRO* Income*(Age1 + Age2), data = pingFull))
summary(lm(TBX_lsRO~ combinedPosteriorNewRO* Income*(Age1 + Age2), data =pingFull))###########
summary(lm(TBX_lsRO~ hippo.Whole.AvgRO* Income*(Age1 + Age2), data = pingFull))
summary(lm(TBX_lsRO~ ratioAntPostCombinedRO* Income*(Age1 + Age2), data = pingFull)) #####


#vocab
summary(lm(TBX_VOCAB_THETARO ~ combinedHeadNewRO* Income*(Age1 + Age2), data = pingFull))
summary(lm(TBX_VOCAB_THETARO ~ combinedPosteriorNewRO* Income*(Age1 + Age2), data = pingFull))
summary(lm(TBX_VOCAB_THETARO ~ hippo.Whole.AvgRO* Income*(Age1 + Age2), data = pingFull))
summary(lm(TBX_VOCAB_THETARO ~ ratioAntPostCombinedRO* Income* (Age1 + Age2), data = pingFull))

summary(pingFull$Age)


```



```{r episodic memory and whole hippocampus}

#episodic memory and whole hippocampus

#including both anterior and posterior volumes ******* 
summaryh(lmer(TBX_ibam_scrRO ~ volume + (1|ID), data = longWhole))
head(longWhole)
summaryh(lmer(TBX_ibam_scrRO ~ volume * hemisphere +  AgeC+ (1|ID), data = longWhole[Age <5]))
summaryh(lmer(TBX_ibam_scrRO ~ volume * hemisphere +  AgeC+ (1|ID), data = longWhole[Age >4.99 &Age < 8.99]))
summaryh(lmer(TBX_ibam_scrRO ~ volume * hemisphere +  AgeC+ (1|ID), data = longWhole[Age >8.99 & Age < 12.99]))
summaryh(lmer(TBX_ibam_scrRO ~ volume * hemisphere +  AgeC+ (1|ID), data = longWhole[Age >12.99]))


summaryh(lm(TBX_ibam_scr~ hippo.Whole.AvgRO, data = pingFull))
summaryh(lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1 + Age2 + income, data = pingFull))

summary(lm(TBX_ibam_scrRO ~ hippo.Whole.AvgRO, data = pingFull))
summary(lm(TBX_ibam_scrRO ~ AgeC, data = pingFull))


summary(lm(TBX_ls ~ Age1 + Age2 + hippo.Whole.AvgRO, data = pingFull))

m1 <- lm(TBX_ibam_scrRO ~AgeC, data = pingFull[!is.na(hippo.Whole.AvgRO)])
m1 <- lm(TBX_ibam_scrRO ~hippo.Whole.AvgRO, data = pingFull[!is.na(hippo.Whole.AvgRO)])
m2 <- lm(TBX_ibam_scrRO ~ AgeC +hippo.Whole.AvgRO, data = pingFull)
anova(m1,m2)



summaryh(lm(TBX_ibam_scrRO ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age <5]))



summaryh(lm(TBX_ibam_scrRO ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age >4.99 &Age < 8.99]))
summaryh(lm(TBX_ibam_scrRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age >4.99 &Age < 8.99]))


summaryh(lm(TBX_ibam_scrRO ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_ibam_scrRO ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age > 12.99]))

```


```{r episodic memory and anterior hippocampus}

#episodic memory and anterior hippocampus
summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO + Age1+ Age2  + GenderEC, data = pingFull))
summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO + Age1+Age2, data = pingFull))


m1 <- lm(TBX_ibam_scrRO ~ combinedHeadNewRO + AgeC, data = pingFull)
m2 <- lm(TBX_ibam_scrRO ~ combinedHeadNewRO + Age1+Age2, data = pingFull)

anova(m1, m2)


m1 <- lm(TBX_ibam_scrRO ~ combinedHeadNewRO + I(combinedHeadNewRO^2), data = pingFull)
m2 <-  lm(TBX_ibam_scrRO ~ combinedHeadNewRO, data = pingFull)
anova(m1, m2)

summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO +  AgeC, data = pingFull))
summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO+  AgeC, data = pingFull))



summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ left.headNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ right.headNewRO+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.headNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) ###############################
summaryh(lm(TBX_ibam_scrRO ~ right.headNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.headNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_ibam_scrRO ~ right.headNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_ibam_scrRO ~ combinedHeadNewRO    +  Age1, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.headNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ right.headNewRO+AgeC, data = pingFull[Age > 12.99]))

```


```{r episodic memory and posterior hippcoampus}


#episodic memory and posterior hippocampus
summaryh(lm(TBX_ibam_scrRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull))
summaryh(lm(TBX_ibam_scrRO ~ left.tailNewRO+AgeC, data = pingFull))
summaryh(lm(TBX_ibam_scrRO ~ right.tailNewRO+AgeC, data = pingFull))

summaryh(lm(TBX_ibam_scrRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ left.tailNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ right.tailNewRO+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_ibam_scrRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.tailNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) ###############################
summaryh(lm(TBX_ibam_scrRO ~ right.tailNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_ibam_scrRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.tailNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_ibam_scrRO ~ right.tailNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_ibam_scrRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.tailNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ right.tailNewRO+AgeC, data = pingFull[Age > 12.99]))

grep(names(pingFull), pattern = "TBX", value = TRUE)

```


```{r episodic memory and ratios hippcoampus}


#episodic memory and ratios 


summaryh(lm(TBX_ibam_scrRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull))
summaryh(lm(TBX_ibam_scrRO ~ right.ratioAntPostNew+AgeC, data = pingFull))
summaryh(lm(TBX_ibam_scrRO ~ left.ratioAntPostNew+AgeC, data = pingFull))

summaryh(lm(TBX_ibam_scrRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ right.ratioAntPostNew+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_ibam_scrRO ~ left.ratioAntPostNew+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_ibam_scrRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99])) #########
summaryh(lm(TBX_ibam_scrRO ~ right.ratioAntPostNew+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) 
summaryh(lm(TBX_ibam_scrRO ~ left.ratioAntPostNew+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_ibam_scrRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ right.ratioAntPostNew+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_ibam_scrRO ~ left.ratioAntPostNew+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_ibam_scrRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ right.ratioAntPostNew+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_ibam_scrRO ~ left.ratioAntPostNew+AgeC, data = pingFull[Age > 12.99]))

```



```{r working memory and whole hippocampus}

#working memory and whole hippocampus

summaryh(lm(TBX_lsRO ~ hippo.Whole.AvgRO    *  AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ hippo.Whole.AvgRO +Age1 , data = pingFull))

summaryh(lm(TBX_lsRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull))


summaryh(lm(TBX_lsRO ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_lsRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_lsRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age <5]))

summaryh(lm(TBX_lsRO ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_lsRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age >4.99 &Age < 8.99]))
summaryh(lm(TBX_lsRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age >4.99 &Age < 8.99]))



summaryh(lm(TBX_lsRO ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_lsRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_lsRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_lsRO ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_lsRO ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_lsRO ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age > 12.99]))




summaryh(lm(TBX_VOCAB_THETA ~ +Age1 + Age2 + income + educationYears , data = pingFull))

```


```{r working memory and anterior hippocampus}

#episodic memory and anterior hippocampus

summaryh(lm(TBX_lsRO ~ combinedHeadNewRO    +  AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ left.headNewRO+AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ right.headNewRO+AgeC, data = pingFull))


summaryh(lm(TBX_lsRO ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_lsRO ~ left.headNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_lsRO ~ right.headNewRO+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_lsRO ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_lsRO ~ left.headNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) ###############################
summaryh(lm(TBX_lsRO ~ right.headNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_lsRO ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_lsRO ~ left.headNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_lsRO ~ right.headNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_lsRO ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_lsRO ~ left.headNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_lsRO ~ right.headNewRO+AgeC, data = pingFull[Age > 12.99]))




```


```{r working memory and posterior hippcoampus}


#working memory and posterior hippocampus
summaryh(lm(TBX_lsRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ left.tailNewRO*AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ right.tailNewRO*AgeC, data = pingFull))

summaryh(lm(TBX_lsRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_lsRO ~ left.tailNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_lsRO ~ right.tailNewRO+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_lsRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_lsRO ~ left.tailNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) ###############################
summaryh(lm(TBX_lsRO ~ right.tailNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_lsRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_lsRO ~ left.tailNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_lsRO ~ right.tailNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_lsRO ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_lsRO ~ left.tailNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_lsRO ~ right.tailNewRO+AgeC, data = pingFull[Age > 12.99]))



```




```{r working memory and ratios hippcoampus}

summaryh(lm(TBX_lsRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ right.ratioAntPostNew+AgeC, data = pingFull))
summaryh(lm(TBX_lsRO ~ left.ratioAntPostNew+AgeC, data = pingFull))

summaryh(lm(TBX_lsRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_lsRO ~ right.ratioAntPostNew+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_lsRO ~ left.ratioAntPostNew+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_lsRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99])) #########
summaryh(lm(TBX_lsRO ~ right.ratioAntPostNew+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) 
summaryh(lm(TBX_lsRO ~ left.ratioAntPostNew+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_lsRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_lsRO ~ right.ratioAntPostNew+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_lsRO ~ left.ratioAntPostNew+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))

summaryh(lm(TBX_lsRO ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_lsRO ~ right.ratioAntPostNew+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_lsRO ~ left.ratioAntPostNew+AgeC, data = pingFull[Age > 12.99]))

```


```{r working memory and ratios hippcoampus}

summaryh(lm(TBX_VOCAB_THETA ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ right.ratioAntPostNew+AgeC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ left.ratioAntPostNew+AgeC, data = pingFull))

summaryh(lm(TBX_VOCAB_THETA ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_VOCAB_THETA ~ right.ratioAntPostNew+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_VOCAB_THETA ~ left.ratioAntPostNew+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_VOCAB_THETA ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99])) #########
summaryh(lm(TBX_VOCAB_THETA ~ right.ratioAntPostNew+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) 
summaryh(lm(TBX_VOCAB_THETA ~ left.ratioAntPostNew+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_VOCAB_THETA ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ right.ratioAntPostNew+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_VOCAB_THETA ~ left.ratioAntPostNew+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))

summaryh(lm(TBX_VOCAB_THETA ~ ratioAntPostCombinedRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ right.ratioAntPostNew+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.ratioAntPostNew+AgeC, data = pingFull[Age > 12.99]))

```


```{r vocab memory and whole hippocampus}

#episodic memory and whole hippocampus

pingFull$TBX_VOCAB_THETA

summaryh(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO + Age1+Age2, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ left.hippo.wholeNewRO+AgeC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ right.hippo.wholeNewRO+AgeC, data = pingFull))


summaryh(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_VOCAB_THETA ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_VOCAB_THETA ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age <5]))

summaryh(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age >4.99 &Age < 8.99]))
summaryh(lm(TBX_VOCAB_THETA ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age >4.99 &Age < 8.99]))


summaryh(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.hippo.wholeNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ right.hippo.wholeNewRO+AgeC, data = pingFull[Age > 12.99]))

```


```{r vocab memory and anterior hippocampus}

#episodic memory and anterior hippocampus

summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO    +  AgeC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ left.headNewRO+AgeC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ right.headNewRO+AgeC, data = pingFull))


summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_VOCAB_THETA ~ left.headNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_VOCAB_THETA ~ right.headNewRO+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.headNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) ###############################
summaryh(lm(TBX_VOCAB_THETA ~ right.headNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.headNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_VOCAB_THETA ~ right.headNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.headNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ right.headNewRO+AgeC, data = pingFull[Age > 12.99]))




```


```{r working memory and posterior hippcoampus}

summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO    +  AgeC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ left.tailNewRO*AgeC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ right.tailNewRO*AgeC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ right.tailNewRO*AgeC, data = pingFull))




summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_VOCAB_THETA ~ left.tailNewRO+AgeC, data = pingFull[Age <5]))
summaryh(lm(TBX_VOCAB_THETA ~ right.tailNewRO+AgeC, data = pingFull[Age <5]))


summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age >4.99 & Age < 8.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.tailNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99])) ###############################
summaryh(lm(TBX_VOCAB_THETA ~ right.tailNewRO+AgeC, data = pingFull[Age >4.99 & Age < 8.99]))

summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age >8.99 & Age < 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.tailNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99])) ###############################
summaryh(lm(TBX_VOCAB_THETA ~ right.tailNewRO+AgeC, data = pingFull[Age >8.99 & Age < 12.99]))


summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO    +  AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ left.tailNewRO+AgeC, data = pingFull[Age > 12.99]))
summaryh(lm(TBX_VOCAB_THETA ~ right.tailNewRO+AgeC, data = pingFull[Age > 12.99]))



```


```{r}
#long memory volumes
head(longAnt )
longPost 
longWhole 
longratio


postWide <- pingFull[, .(ID, left.tailNewRO,right.tailNewRO, TBX_lsRO, TBX_ibam_scrRO, TBX_VOCAB_THETA, AgeC, Age)]
postLong <- gather(postWide,region,volume, -c(ID, TBX_lsRO, TBX_ibam_scrRO, TBX_VOCAB_THETA, AgeC, Age))%>%
       arrange(ID)


head(postLong)

setDT(postLong)
postLong[region == "left.tailNewRO", hemisphere := "left"]
postLong[region == "right.tailNewRO", hemisphere := "right"]
postLong[, region := "tail"]


grep(names(pingFull), pattern = "tail", value = TRUE)
```








```{r}

ggplot(pingFull[!is.na(Income)], aes(Age, combinedPosteriorNewRO, col  = Income)) +
  stat_smooth(method  = 'lm', formula = y ~ x)

summary(lm(combinedPosteriorNewRO ~ Income + AgeC, data = pingFull))


ggplot(pingFull[!is.na(Income)], aes(Age, combinedHeadNewRO, col  = Income)) +
  stat_smooth(method  = 'lm', formula = y ~ x)

summary(lm(combinedPosteriorNewRO ~ Income + Age, data = pingFull))


ggplot(pingFull[!is.na(Income)], aes(Age, ratioAntPostCombinedRO, col  = Income)) +
  stat_smooth(method  = 'lm', formula = y ~ x) + 
  geom_point(alpha  = 0.2)

summary(lm(ratioAntPostCombinedRO ~ Income + Age, data = pingFull))
pingFull[!is.na(Income) & !is.na(ratioAntPostCombinedRO), .N, by = Income]

```




* create a correlation matrix for FA in each age group
```{r}
write.csv(pingWM, file = "forMachineWhiteMatter_April17.csv")
write.csv(pingHippo, file = "forMachineHippo_April17.csv")
write.csv(pingFull, file = "forMachineLearning_April17.csv")

pingWM <- read.csv("forMachineWhiteMatter_April17.csv")
pingHippo <- read.csv("forMachineHippo_April17.csv")
```

```{r}
pingHippo <- pingHippo[, !sapply(pingHippo, is.logical)]
glimpse(pingHippo)

#remove cortical area and MD
pingHippo <- select(pingHippo, (-c(select =  grep("cort_area", names(pingHippo)))))
pingHippo <- select(pingHippo, (-c(select =  grep("DTI_fiber_MD", names(pingHippo)))))
dim(pingHippo)
grep(x = names(pingHippo), pattern = "New", value = TRUE)

```

Do the same thing for pingWM
```{r}
pingWM[, !sapply(pingWM, is.logical)]
pingFull[Income == "high", Income2 := 1]
pingFull[, unique(Income2)]
toMerge <- pingFull[, .( Income2, MRI_subcort_vol.Left.AmygdalaNew, MRI_cort_vol.ctx.rh.inferiortemporalNew, DTI_fiber_vol.R_SIFCNew)]

dim(pingWM)
dim(toMerge)


pingWMNew <- left_join(pingWM, toMerge)

dim(pingWMNew)

#remove MD

pingWMNew <- select(pingWMNew, (-c(select =  grep("DTI_aseg_FA", names(pingWMNew)))))
names(pingWMNew)

#subset only those wiht vols that are "new"
pingWMNew2 <- select(pingWMNew, (-c(select =  grep("MagneticFieldStrength", names(pingWMNew)))))




```

```{r}
#add "new" to WM names to signify they should be kept
namesChange <- grep(names(pingHippo), pattern =  "DTI_fiber_FA")
i <- 184

for (i in namesChange) {
 names(pingHippo)[i] <- paste0(names(pingHippo[i]), 'New')
}

pingHippoNew <- select(pingHippo, grep("New", names(pingHippo)))
merge <- pingHippo[, .(Age, ID, TBX_ls, TBX_ibam_scr, VolRHippocampusNew, MRI_cort_vol.ctx.rh.posteriorcingulateNew)]
pingHippoNew <- left_join(merge, pingHippoNew)
glimpse(pingHippoNew)

names(pingHippo)
  
toMerge <- pingHippo[, .(Income2, right.hippo.wholeNewRO, left.ratioAntPostNew,DTI_fiber_vol.L_pSCSNew )]
dim(pingHippoNew)
dim(toMerge)

rcorr(data.matrix(pingHippoNew1), type = 'pearson')$r %>% 
  data.frame() %>% 
  rownames_to_column() %>% 
  gather(measure, correlation, -rowname) %>% 
  #mutate(p_corrected = p.adjust(correlation, method = 'fdr')) %>%  
  #dplyr::filter(correlation <3, measure == 'tau') %>% 
  tbl_dt() -> pingHippoCorrMatrixLessNine
pingHippoCorrMatrixLessNine[measure == "TBX_ibam_scr", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)

summary(lm(TBX_ibam_scr ~ left.tailNewRO + Age, data = pingFull))

pingHippoCorrMatrixLessNine[measure == "TBX_ls", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoCorrMatrixLessNine[measure == "Age", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoCorrMatrixLessNine[measure == "TBX_ls" & rowname %in%c(grep(names(pingHippo), pattern = "head", value = TRUE)), ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoCorrMatrixLessNine[measure == "TBX_ls", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoCorrMatrix13to17[measure == "TBX_ls", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)

pingHippo13Over[measure == "TBX_ls", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)

pingHippoCorrMatrixLessNine[measure == "Age" & rowname %in%c(grep(names(pingHippo), pattern = "Hippo", value = TRUE)), ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)

library(Hmisc)


rcorr(data.matrix(pingHippoNew[Age >12.99]), type = 'pearson')$r %>% 
  data.frame() %>% 
  rownames_to_column() %>% 
  gather(measure, correlation, -rowname) %>% 
  #mutate(p_corrected = p.adjust(correlation, method = 'fdr')) %>%  
  #dplyr::filter(correlation <3, measure == 'tau') %>% 
  tbl_dt() -> pingHippo13Over
pingHippoLessFive[measure == "TBX_ibam_scr", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoLessFive[measure == "TBX_ls", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoCorrMatrix9to12[measure == "TBX_ibam_scr", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)





pingHippoCorrMatrix9to12[measure == "Age" & rowname %in%c(grep(names(pingHippo), pattern = "hippo", value = TRUE)), ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoCorrMatrix9to12[measure == "Age" & rowname %in%c(grep(names(pingHippo), pattern = "head", value = TRUE)), ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoCorrMatrix9to12[measure == "Age" & rowname %in%c(grep(names(pingHippo), pattern = "posterior", value = TRUE)), ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)


rcorr(data.matrix(pingHippoNew), type = 'pearson')$r %>% 
  data.frame() %>% 
  rownames_to_column() %>% 
  gather(measure, correlation, -rowname) %>% 
  #mutate(p_corrected = p.adjust(correlation, method = 'fdr')) %>%  
  #dplyr::filter(correlation <3, measure == 'tau') %>% 
  tbl_dt() -> pingHippoCorrMatrix13to17
pingHippoCorrMatrix13to17[measure == "TBX_ls", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingHippoCorrMatrix13to17[measure == "Age", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)


rcorr(data.matrix(pingHippoNew[Age >16.99]), type = 'pearson')$r %>% 
  data.frame() %>% 
  rownames_to_column() %>% 
  gather(measure, correlation, -rowname) %>% 
  #mutate(p_corrected = p.adjust(correlation, method = 'fdr')) %>%  
  #dplyr::filter(correlation <3, measure == 'tau') %>% 
  tbl_dt() -> pingHippoCorrMatrix17AndUp
pingHippoCorrMatrix17AndUp[measure == "TBX_ibam_scr", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)

```

```{r}

rcorr(data.matrix(pingHippoNew[Age >16.99]), type = 'pearson')$r %>% 
  data.frame() %>% 
  rownames_to_column() %>% 
  gather(measure, correlation, -rowname) %>% 
  #mutate(p_corrected = p.adjust(correlation, method = 'fdr')) %>%  
  #dplyr::filter(correlation <3, measure == 'tau') %>% 
  tbl_dt() -> pingHippoCorrMatrix17AndUp
pingHippoCorrMatrix2[measure == "TBX_ibam_scr", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
```


* explore the same thing, but with white matter only


```{r}

pingWMNew$TBX_lsRO <- as.integer(pingWMNew$TBX_lsRO)
rcorr(data.matrix(pingWMNew[Age > 16.99]), type = 'pearson')$r %>% 
  data.frame() %>% 
  rownames_to_column() %>% 
  gather(measure, correlation, -rowname) %>% 
  #mutate(p_corrected = p.adjust(correlation, method = 'fdr')) %>%  
  #dplyr::filter(correlation <3, measure == 'tau') %>% 
  tbl_dt() -> pingWMCorrMatrix17AndUp
pingWMCorrMatrix17AndUp[measure == "TBX_ls", ]%>%arrange(desc(abs(correlation)))

pingWMCorrMatrix17AndUp[measure == "TBX_lsRO"]%>%arrange(desc(abs(correlation)))

pingWMCorrMatrix17AndUp[measure == "TBX_ibam_scr", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingWMCorrMatrix17AndUp[measure == "Age", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)


rcorr(data.matrix(pingWMNew[Age <5]), type = 'pearson')$r %>% 
  data.frame() %>% 
  rownames_to_column() %>% 
  gather(measure, correlation, -rowname) %>% 
  #mutate(p_corrected = p.adjust(correlation, method = 'fdr')) %>%  
  #dplyr::filter(correlation <3, measure == 'tau') %>% 
  tbl_dt() -> pingWMCorrMatrixLess5
pingWMCorrMatrixLess5[measure == "TBX_ls", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingWMCorrMatrixLess5[measure == "TBX_ibam_scr", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
pingWMCorrMatrixLess5[measure == "Age", ]%>%arrange(desc(abs(correlation)))%>%
  print(n=400)
```




```{r}

pingFull[,TBX_ibam_scrRO := outliersZ(TBX_ibam_scr, zCutOff = 1.96, replaceOutliersWith = NA)]
pingFull[,TBX_lsRO := outliersZ(TBX_ls, zCutOff = 1.96, replaceOutliersWith = NA)]


ggplot(pingFull, aes(Age,TBX_lsRO))+
    geom_point() + 
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) +
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

toMerge <- pingFull[, .(TBX_ibam_scrRO,DTI_fiber_vol.L_AllFibnoCCNew, DTI_fiber_vol.L_pSCSNew)]

dim(toMerge)
dim(pingHippoNew)

pingHippoNew <- left_join(pingHippoNew, toMerge)



```






```{r explore demographic variables}


### exploring demographic variables ####
pingFull <- tbl_dt(fullPing)

#explore full sample
pingFull[!is.na(volRLatOrbitofrontal), .N]
pingFull[!is.na(volLSuperiorFrontalNew), .N]

#number males/females
pingFull[!is.na(volLSuperiorFrontalNew), .N, by = Gender]

#age
pingFull[!is.na(volLSuperiorFrontalNew), mean(Age_At_NPExam, na.rm=TRUE)]
pingFull[!is.na(volLSuperiorFrontalNew), range(Age_At_NPExam, na.rm=TRUE)]
pingFull[!is.na(volLSuperiorFrontalNew), max(Age, na.rm=TRUE)]
pingFull[!is.na(volLSuperiorFrontalNew) & Age > 20, .(Age, na.rm=TRUE)]%>%print(n=Inf)
pingFull[!is.na(volLSuperiorFrontalNew), sd(Age, na.rm=TRUE)]

#parental education
pingFull[,educationYears] 
pingFull$FDH_Guardian_1_Edu
pingFull[!is.na(FDH_Guardian_1_Edu & volLSuperiorFrontalNew)  , mean(FDH_Guardian_1_Edu)]
pingFull[!is.na(FDH_Guardian_1_Edu & volLSuperiorFrontalNew), .N, by = (FDH_Guardian_1_Edu)]

#income
pingFull[!is.na(volLSuperiorFrontalNew), .N, by = Income]
pingFull[!is.na(FDH_Guardian_1_Edu & volLSuperiorFrontalNew), .N, by = (FDH_3_Household_Income)]
pingFull$FDH_3_Household_Income
pingSubset[!is.na(right.headNew), .N]

# scanner

#number excluded because of poor scanner or segmentation
pingFull[!is.na(right.headNew), .N]
pingFull[!is.na(right.hippo.wholeNew), .N]

#no relationship between age and ICV
cor.test(ping$Age_At_NPExam, ping$ICV)
plot(ICV ~ Age, data = ping)

#compute ratio of anterior to posterior volumes
pingSubset[, .(left.headNew, left.tailNew)]
pingSubset[,  sd(left.headNew)]
pingSubset[,  sd(left.tailNew)]

#more deviation in the hippocampal head
pingSubset[,  sd(left.head)]
pingSubset[,  sd(left.tail)]

cor.test(pingSubset$left.headNew, pingSubset$left.tailNew)
cor.test(pingSubset$left.head, pingSubset$left.tail)

```


#genes

```{r}
genes <- read.csv("genes.csv")
pingFull <- left_join(pingFull, genes)
names(genes)

pingFull[, .N, by = rs4680]
pingFull$TBX_VOCAB_THETA


pingFull[!is.na(TBX_ibam_scr) & !is.na(AgeC), TBX_ibam_residuals:= residuals(lm(TBX_ibam_scr ~ AgeC))]

pingFull[!is.na(TBX_ls) & !is.na(AgeC), TBX_ls_residuals:= residuals(lm(TBX_ls ~ AgeC))]

ggplot(pingFull[!is.na(rs4680) & rs4680 != "AG"], aes(Age, TBX_ls, col = rs4680)) + 
         stat_smooth(method = "lm", formula = y ~ poly(x,2))+
         geom_point(alpha = .2)


pingFull[!is.na(TBX_lsRO) & !is.na(AgeC), TBX_ls_residuals := residuals(lm(TBX_lsRO ~ AgeC))]


ggplot(pingFull[!is.na(rs4680) & !is.na(Income)], aes(rs4680, TBX_ls_residuals, col  = Income)) + 
 stat_summary(fun.y = mean,
               fun.ymin = function(x) mean(x) - se(x), 
               fun.ymax = function(x) mean(x) + se(x), 
               geom = "pointrange") +
  labs(y = "working memory score \n corrected residuals for age") +
  scale_x_discrete(breaks = c("AA", "AG", "GG"),
                   labels = c("met/met", "met/val", "val/val")) + 
  theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

ggplot(pingFull[!is.na(rs4680) & !is.na(Income)], aes(rs4680, TBX_ls_residuals, col = Income)) + 
 stat_summary(fun.y = mean,
               fun.ymin = function(x) mean(x) - se(x), 
               fun.ymax = function(x) mean(x) + se(x), 
               geom = "pointrange") +
  labs(y = "working memory score \n corrected residuals for age") +
  scale_x_discrete(breaks = c("AA", "AG", "GG"),
                   labels = c("met/met", "met/val", "val/val")) + 
  theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

summary(lm(TBX_ls ~ rs4680 + Age1 , data = pingFull[!is.na(Income)]))





names(genes)

ggplot(pingFull[!is.na(rs1137070)], aes(rs1137070, TBX_ls_residuals)) + 
 stat_summary(fun.y = mean,
               fun.ymin = function(x) mean(x) - se(x), 
               fun.ymax = function(x) mean(x) + se(x), 
               geom = "pointrange") +
  labs(y = "working memory score \n corrected residuals for age") +
  theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

pingFull[!is.na(Income) & !is.na(rs4680), .N, by = .(rs4680, Income)]

pingFull[, .(FDH_Highest_Education)]%>%print(n=60)
pingFull[FDH_Highest_Education %in% c(1,2,3), edu := 1]
pingFull[FDH_Highest_Education %in% c(4,5), edu := 2]
pingFull[FDH_Highest_Education %in% c(6,7), edu := 3]


ggplot(pingFull[!is.na(rs4680)], aes(rs4680, TBX_ls_residuals, col  = edu)) + 
 stat_summary(fun.y = mean,
               fun.ymin = function(x) mean(x) - se(x), 
               fun.ymax = function(x) mean(x) + se(x), 
               geom = "pointrange") +
  labs(y = "working memory score \n corrected residuals for age") +
  scale_x_discrete(breaks = c("AA", "AG", "GG"),
                   labels = c("met/met", "met/val", "val/val")) + 
  theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


summary(lm(TBX_ls ~ rs4680 + (Age1+ Age2), data = pingFull))
pingFull[, .N, by = .(edu, rs4680)]


ggplot(pingFull[!is.na(rs4680)], aes(Age, MRI_cort_thick.ctx.lh.inferiorparietal, col = rs4680)) + 
         stat_smooth(method = "lm", formula = y ~ poly(x,2))


ggplot(pingFull[!is.na(rs4680)], aes(Age, cort_thick_lateralorbitofrontal_combo, col = rs4680)) + 
         stat_smooth(method = "lm", formula = y ~ poly(x,2))+
labs(y = "cortical thickness \nof lateral orbital frontal")+ theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 


grep(names(pingFull), pattern = "thick", value  = TRUE)


summary(lm(TBX_ls ~ rs4680 * (Age1 + Age2), data = pingFull))
summary(lm(TBX_ls ~ rs4680, data = pingFull[Age > 14]))
pingFull[, .(GenderEC, Gender)]






```


* do genes significantly mediate the relationship between cortical thickness and comt
```{r}
#Number in each group
pingFull[!is.na(rs4680), .N, by = rs4680]


#do genes influence working memory performance?
summary(lm(TBX_ls ~ rs4680 * (Age1 + Age2), data = pingFull))
summary(lm(TBX_ls ~ rs4680, data = pingFull[Age > 14]))
summary(lm(TBX_ls ~ rs46802 + Age1+Age2, data = pingFull))



#do genes influence cortical thickness? yes. widespread changes across cortex - cortical thickness
summary(lm(cort_thick_precuneus_combo ~ rs4680 + (Age1 + Age2), data = pingFull)) #yes
summary(lm(cort_thick_rostralmiddlefrontal_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #no
summary(lm(cort_thick_inferiorparietal_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #yes
summary(lm(cort_thick_lateraloccipital_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #yes
summary(lm(cort_thick_bankssts_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #yes
summary(lm(cort_thick_caudalanteriorcingulate_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #no
summary(lm(cort_thick_cuneus_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #yes
summary(lm(cort_thick_superiorparietal_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #yes
summary(lm(cort_thick_frontalpole_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #no
summary(lm(cort_thick_inferiortemporal_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #yes
summary(lm(cort_thick_lateralorbitofrontal_combo ~ rs4680+ (Age1 + Age2), data = pingFull)) #yes
summary(lm(cort_thick_medialorbitofrontal_combo ~ rs4680+ (Age1 + Age2), data = pingFull))#yes


#does cortical thickness mediate the relationship between genes and working memory?
#yes

library(mediation)

#mediate model for  cuneous
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_precuneus_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_precuneus_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_precuneus_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_precuneus_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_precuneus_combo")
summary(Model.mediate)

#mediate model for cort_thick_inferiorparietal_combo
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_inferiorparietal_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_inferiorparietal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_inferiorparietal_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_inferiorparietal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_inferiorparietal_combo")
summary(Model.mediate)


#mediate model for cort_thick_lateraloccipital_combo
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_lateraloccipital_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_lateraloccipital_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_lateraloccipital_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_lateraloccipital_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_lateraloccipital_combo")
summary(Model.mediate)


#mediate model for cort_thick_bankssts_combo banks of superior temporal sucus
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_bankssts_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_bankssts_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_bankssts_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_bankssts_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_bankssts_combo")
summary(Model.mediate)


#mediate model for cort_thick_cuneus_combo
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_cuneus_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_cuneus_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_cuneus_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_cuneus_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_cuneus_combo")
summary(Model.mediate)

#mediate model for cort_thick_superiorparietal_combo
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_superiorparietal_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_superiorparietal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_superiorparietal_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_superiorparietal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_superiorparietal_combo")
summary(Model.mediate)


#mediate model for cort_thick_inferiortemporal_combo
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_inferiortemporal_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_inferiortemporal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_inferiortemporal_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_inferiortemporal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_inferiortemporal_combo")
summary(Model.mediate)


#mediate model for cort_thick_lateralorbitofrontal_combo
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_lateralorbitofrontal_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_lateralorbitofrontal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_lateralorbitofrontal_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_lateralorbitofrontal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_lateralorbitofrontal_combo")
summary(Model.mediate)


#mediate model for cort_thick_lateralorbitofrontal_combo
model.y <- lm(TBX_ls ~ rs4680 + cort_thick_medialorbitofrontal_combo + (Age1  + Age2), data =  pingFull[!is.na(rs4680) & !is.na(cort_thick_medialorbitofrontal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.y)

model.m <- lm(cort_thick_medialorbitofrontal_combo ~ rs4680 + (Age1 + Age2), data = pingFull[!is.na(rs4680) & !is.na(cort_thick_medialorbitofrontal_combo)& !is.na(TBX_ls) & rs4680 != "AG"])
summary(model.m)

Model.mediate <- mediate(model.m, model.y, sims = 100, treat = "rs4680", mediator = "cort_thick_medialorbitofrontal_combo")
summary(Model.mediate)

```


Descriptive statistics table 

```{r}
pingFull[!is.na(combinedPosteriorNew), .N]
pingFull[!is.na(combinedHeadNew), .N]
pingFull[!is.na(ratioAntPostCombinedNew), .N]
pingFull[!is.na(combinedPosteriorNew) & is.na(combinedHeadNew)]
pingFull[!is.na(combinedHeadNew) & is.na(combinedPosteriorNew)]
pingFull[!is.na(combinedHeadNew) & is.na(ratioAntPostCombinedNew), .(ratioAntPostCombined) ]
pingFull[, ratioAntPosterCombinedNew2 := combinedHeadNew/]

pingFull[!is.na(Age_At_IMGExam), .N, by = Gender]

pingFull[!is.na(motion), .N]
pingFull[!is.na(motionNew), .N]

pingFull[!is.na(motion), .N, by =  Gender]

shared <- read.csv("neuorimagingShared.csv")
shared$shared <- 1
names(shared)
names(pingFull)[1]
dim(shared)
dim(pingFull)

demographics <- left_join(shared, pingFull)
dim(demographics)
setDT(demographics   )
demographics[, .N, by = Gender]


demographics[, mean(Age, na.rm=TRUE)]

demographics[, sd(Age, na.rm=TRUE)]

pingFull[!is.na(combinedHeadNew), .N, by = Gender]
pingFull[!is.na(combinedHeadNew), sd(Age, na.rm=TRUE)]



pingFull[!is.na(combinedPosteriorNew) & is.na(combinedPosteriorNewRO), .N,]
pingFull[!is.na(ratioAntPostCombinedNew) & is.na(ratioAntPostCombinedNewRO), .N,]

pingFull[!is.na(whole) & is.na(ratioAntPostCombinedNewRO), .N,]


```

demographics table

```{r}

dim(demographics)
demographics[, .N, by = ethnicity]
names(demographics)[1:3]
toMerge <- pingSubset[, .(ID, ethnicity)]
demographics2 <- left_join(demographics, toMerge)

demographics2[, .N, by = ethnicity]

demographics[, .(FDH_Highest_Education)]

cor.test(demographics$FDH_Highest_Education, demographics$TBX_VOCAB_THETA)
cor.test(demographics$FDH_Highest_Education, demographics$combinedPosteriorNewRO)
  
summary(lm(FDH_Highest_Education ~ combinedPosteriorNewRO + AgeC, data = demographics))
summary(lm(FDH_Highest_Education ~ combinedPosteriorNewRO + AgeC, data = demographics))


grep(pingSubset, pattern = ">", value  = TRUE)

```



```{r}

ggplot(pingFull[!is.na(Income)], aes(Age, combinedPosteriorNewRO, col = Income)) + 
  stat_smooth(formula = y ~ x, method = "lm")


ggplot(pingFull[!is.na(Income)], aes(Age, combinedHeadNewRO, col = Income)) + 
  stat_smooth(formula = y ~ x, method = "lm")


ggplot(pingFull[!is.na(rs4680)], aes( Age, combinedHeadNewRO, col = rs4680)) + 
  stat_smooth(formula = y ~ x, method = "lm")


ggplot(pingFull[!is.na(rs4680)], aes( Age, combinedPosteriorNewRO, col = rs4680)) + 
  stat_smooth(formula = y ~ x, method = "lm")





summary(lm(combinedHeadNewRO ~ Income + Age, data = pingFull))
summary(lm(combinedPosteriorNewRO ~ Income+ Age, data = pingFull))


summary(lm(combinedHeadNewRO ~ rs4680 + Age, data = pingFull))
summary(lm(combinedPosteriorNewRO ~ rs4680+ Age, data = pingFull))
summary(lm(ratioAntPostCombinedNewRO ~ rs4680 + Age, data = pingFull))

pingFull$ratioAntPostCombinedNewRO


```

#don's heirarchical regression 

```{r}
#both age and hpc volume are significant predictor when both are in model
# model comparison shows that by adding one to the model, it explains memory perf better
#thus, both age and hpc volume add unique variance 
m1 <- lm(TBX_ibam_scrRO ~AgeC, data = pingFull[!is.na(hippo.Whole.AvgRO)])
m1 <- lm(TBX_ibam_scrRO ~hippo.Whole.AvgRO, data = pingFull[!is.na(hippo.Whole.AvgRO)])

m2 <- lm(TBX_ibam_scrRO ~  (Age1+Age2) +hippo.Whole.AvgRO, data = pingFull)
anova(m2)


m5 <- lm(TBX_ibam_scrRO ~  (Age1+Age2), data = pingFull[!is.na(hippo.Whole.AvgRO)])

m6 <- lm(TBX_lsRO ~ (Age1+Age2) + hippo.Whole.AvgRO, data = pingFull[!is.na(hippo.Whole.AvgRO)])
m6b <- lm(TBX_lsRO ~  hippo.Whole.AvgRO + (Age1+Age2) , data =pingFull[!is.na(hippo.Whole.AvgRO)])

anova(m6)
anova(m6b)


summary(m6)


m7 <- lm(TBX_ibam_scrRO ~  hippo.Whole.AvgRO * (Age1+Age2) , data =pingFull[!is.na(hippo.Whole.AvgRO)])
anova(m6, m7)
summaryh(m7)
summaryh(m6)





m6 <- lm(TBX_ibam_scrRO ~  hippo.Whole.AvgRO + Income + (Age1 + Age2), data=pingFull[!is.na(hippo.Whole.AvgRO)])
summaryh(m6)

m7 <- lm(TBX_ibam_scrRO ~  combinedHeadNewRO + Income + (Age1 + Age2), data=pingFull[!is.na(hippo.Whole.AvgRO)])
summaryh(m6)

m6 <- lm(TBX_ibam_scrRO ~  combinedPosteriorNewRO  + Income+ (Age1 + Age2), data=pingFull[!is.na(hippo.Whole.AvgRO)])
summaryh(m6)


###mediation analysis###
# does smaller anterior hippocampal volumes (after accounting for age) mediate the relationship between income and memory?

pingFull[, logIncome3 := log(income3)]
library(mediation)

model.y <- lm(TBX_ibam_scr ~ combinedHeadNewRO * (GenderEC + AgeC) + logIncome3, data = pingFull)
summary(model.y)

model.m <- lm(combinedHeadNewRO ~logIncome3 + AgeC + DeviceSerialNumber + GenderEC, data = pingFull[!is.na(TBX_ibam_scr)])
summary(model.m)

model.mediate <- mediate(model.m = model.m, model.y = model.y, sims = 5000, treat = "logIncome3", mediator = "combinedHeadNewRO",boot = TRUE)

summary(model.mediate); standard.errors(model.mediation)
standard.errors(model.mediate)

#vocab
model.yV <- lm(TBX_VOCAB_THETA ~ combinedHeadNewRO * (GenderEC + AgeC) + logIncome3, data = pingFull)
summary(model.yV)

model.mV <- lm(combinedHeadNewRO ~logIncome3 + AgeC + DeviceSerialNumber + GenderEC, data = pingFull[!is.na(TBX_VOCAB_THETA)])
summary(model.mV)

model.mediateV <- mediate(model.m = model.mV, model.y = model.yV, sims = 5000, treat = "logIncome3", mediator = "combinedHeadNewRO",boot = TRUE)

summary(model.mediateV); standard.errors(model.mediateV)




#does anterior volume mediate the relationship between age and memory 

model.y2 <- lm(TBX_ibam_scr ~ hippo.Whole.AvgRO * (GenderEC + AgeC) + logIncome3, data = pingFull)
summary(model.y2)

model.m2 <- lm(hippo.Whole.AvgRO ~logIncome3 + AgeC + DeviceSerialNumber + GenderEC, data = pingFull[!is.na(TBX_ibam_scr)])
summary(model.m2)

model.mediate2 <- mediate(model.m = model.m2, model.y = model.y2, sims = 5000, treat = "AgeC", mediator = "hippo.Whole.AvgRO",boot = TRUE)

summary(model.mediate2); standard.errors(model.mediate2)
standard.errors(model.mediate)

#does anterior volume mediate the relationship between age and vocab 

model.y2b <- lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO * (GenderEC + AgeC) + logIncome3, data = pingFull)
summary(model.y2b)

model.m2b <- lm(hippo.Whole.AvgRO ~logIncome3 + AgeC + DeviceSerialNumber + GenderEC, data = pingFull[!is.na(TBX_VOCAB_THETA)])
summary(model.m2b)

model.mediate2b <- mediate(model.m = model.m2b, model.y = model.y2b, sims = 5000, treat = "AgeC", mediator = "hippo.Whole.AvgRO",boot = TRUE)

summary(model.mediate2b); standard.errors(model.mediate2b)
standard.errors(model.mediate2b)


summaryh(lm(ratioAntPostCombined ~ logIncome3 + Age1 + DeviceSerialNumber + GenderEC + combinedHeadNewRO, pingFull))


install.packages("QuantPsyc")
library(mediation)
#working memory
model.y_wm <- lm(TBX_ls ~ income + AgeC + combinedHeadNewRO, data = pingFull)
summary(model.y_wm)

model.m_wm <- lm(combinedHeadNewRO ~ income + AgeC, data = pingFull[!is.na(TBX_ls)])
summary(model.m_wm)

model.mediate_wm <- mediate(model.m = model.m_wm, model.y = model.y_wm, sims = 5000, treat = "income", mediator = "combinedHeadNewRO")
summary(model.mediate_wm)


#vocab
model.y_vocab <- lm(TBX_ibam_scr ~ logIncome3 + AgeC + combinedHeadNewRO, data = pingFull)
summary(model.y_vocab)

model.m_vocab <- lm(combinedHeadNewRO ~ logIncome3 + AgeC + DeviceSerialNumber, data = pingFull[!is.na(TBX_ibam_scr)])
summary(model.m_vocab)

model.mediate_vocab <- mediate(model.m = model.m_vocab, model.y = model.y_vocab, sims = 5000, treat = "logIncome3", mediator = "combinedHeadNewRO")
summary(model.mediate_vocab)

model.mediate_vocab_boot <- mediate(model.m = model.m_vocab, model.y = model.y_vocab, sims = 5000, treat = "logIncome3", mediator = "combinedHeadNewRO", boot = TRUE)
summary(model.mediate_vocab_boot)



summary(lm(FDH_40p_Learn_Prob_Total ~ logIncome3, data = pingFull))

FDH_40p_Learn_Prob_Total


grep(pingFull, pattern= "anxiety", value = TRUE)

pingFull[,1550:1650]

###mediation analysis###
# do hippocampal volumes mediate the relationship between age and memory?

library(mediation)
model.y <- lm(TBX_ibam_scr ~ income + Age1  + Age2  + combinedHeadNewRO + GenderEC, data = pingSubset)
summary(model.y)

model.m <- lm(combinedHeadNewRO ~ income  + Age1 , data = pingSubset[!is.na(TBX_ibam_scr)])
summary(model.m)

model.mediate <- mediate(model.m = model.m, model.y = model.y, sims = 5000, treat = c("Age1", "Age2"), mediator = "combinedHeadNewRO")
summary(model.mediate)


#vocab
model.y <- lm(TBX_VOCAB_THETA ~ income + AgeC + combinedHeadNewRO, data = pingSubset)
summary(model.y)

model.m <- lm(combinedHeadNewRO ~ income + AgeC, data = pingSubset[!is.na(TBX_VOCAB_THETA)])
summary(model.m)

model.mediate <- mediate(model.m = model.m, model.y = model.y, sims = 5000, treat = "AgeC", mediator = "combinedHeadNewRO")
summary(model.mediate)

# do hippocampal volumes mediate the relationship between age and memory?

library(mediation)
model.y <- lm(TBX_ibam_scr ~ income + AgeC + hippo.Whole.AvgRO, data = pingSubset)
summary(model.y)

model.m <- lm(hippo.Whole.AvgRO ~ income + AgeC, data = pingSubset[!is.na(TBX_ibam_scr)])
summary(model.m)

model.mediate <- mediate(model.m = model.m, model.y = model.y, sims = 5000, treat = "AgeC", mediator = "hippo.Whole.AvgRO")
summary(model.mediate)


#vocab
model.y <- lm(TBX_VOCAB_THETA ~ income + AgeC + hippo.Whole.AvgRO, data = pingSubset)
summary(model.y)

model.m <- lm(hippo.Whole.AvgRO ~ income + AgeC, data = pingSubset[!is.na(TBX_VOCAB_THETA)])
summary(model.m)

model.mediate <- mediate(model.m = model.m, model.y = model.y, sims = 5000, treat = "AgeC", mediator = "hippo.Whole.AvgRO")
summary(model.mediate)


```



```{r}
ggplot(pingFull[!is.na(Income)], aes(Age,combinedHeadNewRO, col= Income)) +
  stat_smooth(formula = y ~ x, method = 'lm')

ggplot(pingFull[!is.na(Income)], aes(Age, combinedPosteriorNewRO, col= Income)) +
  stat_smooth(formula = y ~ x, method = 'lm')

ggplot(pingFull[!is.na(Income)], aes(Age, hippo.Whole.AvgRO, col= Income)) +
  stat_smooth(formula = y ~ x, method = 'lm')

```



```{r}
ggplot(pingFull, aes(TBX_ls, Age, Gender))+
  geom_smooth()

```

#motion?
```{r}
pingFull[!is.na(Age_At_IMGExam) & motion == 0, .(motion, combinedHead, combinedHeadNew, combinedHeadNewRO)]
pingFull[!is.na(Age_At_IMGExam) & !is.na(motion), .(motion, combinedHead, combinedHeadNew, combinedHeadNewRO)]

pingFull[!is.na(combinedHeadNewRO), .N]
pingFull[!is.na(combinedHeadNewRO) & !is.na(Income), .N]

pingFull[!is.na(combinedHead) & !is.na(TBX_VOCAB_THETA), .N]
pingFull[!is.na(combinedHeadNewRO) & !is.na(TBX_ibam_scr), .N]



pingFull[!is.na(combinedPosteriorNewRO), .N]
pingFull[!is.na(combinedPosterior), .N]


pingFull[!is.na(combinedPosteriorNewRO), .N]
pingFull[!is.na(combinedPosterior), .N]

pingFull[!is.na(hippo.Whole.AvgRO), .N]
pingFull[!is.na(hippo.Whole.Avg), .N]


pingFull[!is.na(ratioAntPostCombined), .N]


```


p-adjustments for fdr correction

```{r}
#age
agePValues <- c(0.006, 0.00005, 0.00000001, 0.011, 0.003)
agePValuesAdjust <- p.adjust(agePValues, method = "fdr")

#sex
sexPValues <- c(0.135, 0.008, 0.812, 0.025)
sexPValuesAdjust <- p.adjust(sexPValues, method = "fdr")

#income
incomePValuesAntVol <- c(0.0049, 0.031, 0.52)
incomePValuesAntVolAdjust <- p.adjust(incomePValuesAntVol, method = "fdr")


#income ratios
incomePValuesRatioVol <- c(0.00009, 0.002, 0.536)
incomePValuesRatioVolAdjust <- p.adjust(incomePValuesRatioVol, method = "fdr")

pingFull$ratioAntPostCombined

summary(lm(ratioAntPostCombined ~ AgeC + GenderEC + Income, data = pingFull))
summary(lm(combinedHeadNewRO ~ AgeC + GenderEC + Income, data = pingFull))


summaryh(lm(TBX_ibam_scr ~ Age1 + Age2  + income, data = pingFull[!is.na(income) & !is.na(combinedHeadNewRO)]))

memoryPValuesGender <- c(0.52, 0.036, 0.002)
memoryPValuesGenderAdjust <- p.adjust(memoryPValuesGender, method = "fdr")

memoryPValuesIncome <- c(0.42, 0.009, 0.04)
memoryPValuesIncomeAdjust <- p.adjust(memoryPValuesIncome, method = "fdr")

```


* differences in low/med/high income?

```{r}
summary(lm(left.hippo.whole ~ educationYears + Age1 + Age2,data = pingFull))
summary(lm(right.hippo.whole ~ educationYears + Age1 + Age2,data = pingFull))

summary(lm(left.hippo.whole ~ educationYears + Age1 + Age2,data = pingFull[!is.na(combinedHeadNewRO)]))
summary(lm(MRI_subcort_vol.Left.Hippocampus ~ educationYears + Age1 + Age2 ,data = pingFull))

summary(lm(right.hippo.whole ~ Income + Age1 + Age2,data = pingFull[!is.na(combinedHeadNewRO)]))
summary(lm(MRI_subcort_vol.Right.Hippocampus ~ Income + Age1 + Age2 ,data = pingFull[!is.na(combinedHeadNewRO)]))

pingFull[!is.na(MRI_subcort_vol.Left.Hippocampus) & !is.na(Age1), MRI_subcort_vol.Left.Hippocampus_residuals := residuals(lm(MRI_subcort_vol.Left.Hippocampus ~ Age1 + Age2))]

grep(names(pingFull), value = TRUE, pattern = "residu")



summary(lm(combinedHeadNewRO ~ educationYears+ AgeC + Income,data = pingFull))

summary(lm(hippo.Whole.AvgRO ~ FDH_Guardian_1_Edu + Age1 + Age2, data = pingFull))

pingFull[, .(avgParentEdu, FDH_Guardian_1_Edu, FDH_Guardian_2_Edu)]
pingFull[, avgParentEdu := mean(c(FDH_Guardian_1_Edu,FDH_Guardian_2_Edu), na.rm=TRUE)]




grep(names(pingFull), value = TRUE, pattern = "hippo")

ggplot(pingFull, aes(educationYears, combinedPosteriorNewRO)) +
  #geom_point(alpha = 0.2) +
 stat_summary(fun.y = mean,
               fun.ymin = function(x) mean(x) - se(x), 
               fun.ymax = function(x) mean(x) + se(x), 
               geom = "pointrange") +
  labs(y = "Posterior hippocampal volumes")

ggplot(pingFull, aes(educationYears, combinedPosteriorNewRO)) +
  #geom_point(alpha = 0.2) +
  stat_smooth(formula = y ~ x, method = 'lm') + 
  labs(y = "Posterior hippocampal volumes")


pingFull[!is.na(educationYears), list(number_of_obs.=.N), by = educationYears]%>%
  arrange(educationYears)

pingFull[, mean(combinedHeadNewRO_residualized, na.rm=TRUE)]


summary(lm(hippo.Whole.AvgRO ~ Age1 + Age2 + GenderEC + educationYears + income, data = pingFull))
summary(lm(hippo.Whole.AvgRO ~ Age1 + Age2 + educationYears + income, data = pingFull))


pingFull[!is.na(hippo.Whole.AvgRO),hippo.Whole.AvgRO_residuals := residuals(lm(hippo.Whole.AvgRO ~ Age1 + Age2))]

pingFull$hippo.Whole.AvgRO
ggplot(pingFull, aes(educationYearsLog, hippo.Whole.AvgRO_residuals)) +
  #geom_point(alpha = 0.2) +
 stat_summary(fun.y = mean,
               fun.ymin = function(x) mean(x) - se(x), 
               fun.ymax = function(x) mean(x) + se(x), 
               geom = "pointrange")+
  stat_smooth(formula = y ~ x, method = 'lm')

pingFull$educationyearsZ

pingFull[,.N, educationYears]%>%arrange(educationYears)
pingFull$educationYears2 <- NULL


pingFull[educationYears==1, educationYears2 := 6]
pingFull[educationYears == 2, educationYears2 := 8]
pingFull[educationYears == 3, educationYears2 := 10.5]
pingFull[educationYears == 4, educationYears2 := 12]
pingFull[educationYears == 5, educationYears2 := 14]
pingFull[educationYears == 6, educationYears2 := 16]
pingFull[educationYears == 7, educationYears2 := 18]

summary(lm(combinedHeadNewRO ~ educationYears2  + Age1, data = pingFull))
summary(lm(combinedPosteriorNewRO ~ educationYears2  + Age1, data = pingFull))
summary(lm(hippo.Whole.AvgRO ~ educationYears2  + Age1, data = pingFull))

pingFull[!is.na(combinedHead), .N]

pingFull[!is.na(motion), .N, by = motion]




pingFull[, .(income, income2, income3, combinedHeadNewRO)]%>%print(n=20)
AntPostSlopes

pingSubset[!is.na(combinedHeadNewRO), head_resid := residuals(lm(combinedHeadNewRO ~ GenderEC + AgeC + DeviceSerialNumber))]
pingSubset[!is.na(combinedPosteriorNewRO), posterior_resid := residuals(lm(combinedPosteriorNewRO ~ GenderEC + AgeC + DeviceSerialNumber))]

toMerge <- pingSubset[, .(ID, posterior_resid,head_resid )]

AntPostSlopes <- left_join(AntPostSlopes, toMerge)

AntPostSlopes <- AntPostSlopes[!is.na(logIncome3),]
regionImage <- seWithin(data = AntPostSlopes, measurevar = c('volume'), withinvars = c('region'),betweenvars = c('logIncome3'), idvar = 'ID')

AntPostSlopes[,volumes_resid := posterior_resid]
AntPostSlopes[region == "combinedHeadNewRO",volumes_resid := head_resid]
AntPostSlopes[region == "combinedHeadNewRO",region2 := "Anterior"]
AntPostSlopes[region == "combinedPosteriorNewRO",region2 := "Posterior"]



regionImage <- seWithin(data = AntPostSlopes, measurevar = c('volumes_resid'), withinvars = c('region2'),betweenvars = c('logIncome3'), idvar = 'ID')

ggplot(regionImage, aes(logIncome3, volumes_resid, col = region2)) +
    geom_smooth(formula = y ~ log(x), method = 'lm')+
   labs(y = "Adjusted volumes (mm^3; residuals)", x = "Household Income", col = "Region")+
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(limits = c(7.8, 13.5)) +
  coord_cartesian(xlim = c(7.8, 13.5), expand = FALSE)+
  scale_x_continuous(breaks = c(7.8, 8.41, 9.62, 10.7, 11.7, 12.7), labels = c(0, "4,500","15,000","45,000", "125,000", "325,000"))



headIncome <- ggplot(pingSubset, aes(logIncome3, combinedHeadNewRO)) +
  #geom_point(alpha = 0.2, color = "maroon", size = 3) +
 #stat_summary(fun.y = mean, geom = "point", size = 3) +
   #stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = 1)+
  labs(y = "Anterior hippocampal volume \n (mm^3; residuals)", x = "Household Income")+
  stat_smooth(formula = y ~ log(x), method = 'lm', color  = "black") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(limits = c(7.8, 13.5)) +
  coord_cartesian(xlim = c(7.8, 13.5), expand = FALSE)+
  scale_x_continuous(breaks = c(7.8, 8.41, 9.62, 10.7, 11.7, 12.7), labels = c(0, "4,500","15,000","45,000", "125,000", "325,000"))



ratioIncome <- ggplot(pingFull, aes(logIncome3, ratio_residualized)) +
  geom_point(alpha = 0.2, size = 3, color = "purple") +
 #stat_summary(fun.y = mean, geom = "point", size = 3) +
   #stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = 1)+
  labs(y = "Hippocampal volume ratios \n (mm^3; residuals)", x = "Household Income")+
  stat_smooth(formula = y ~ x, method = 'lm', color = "black") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(limits = c(7.8, 13.5)) +
  coord_cartesian(xlim = c(7.8, 13.5), expand = FALSE)+
  scale_x_continuous(breaks = c(7.8, 8.41, 9.62, 10.7, 11.7, 12.7), labels = c(0, "4,500","15000","45,000", "125,000", "325,000"))


plot_grid(headIncome, ratioIncome, labels = c('A', 'B'),align = "hv")
  
plot_grid
library("cowplot")


ggplot(pingFull, aes(logIncome3, whole_residualized)) +
  #geom_point(alpha = 0.2) +
 stat_summary(fun.y = mean, geom = "point", size = 3) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = 1)+
  labs(y = "Whole hippocampal volume \n (mm^3; residuals)", x = "Household Income")+
  stat_smooth(formula = y ~ x, method = 'lm') +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(limits = c(7.8, 13.5)) +
  coord_cartesian(xlim = c(7.8, 13.5), expand = FALSE)+
  scale_x_continuous(breaks = c(7.8, 8.41, 9.62, 10.7, 11.7, 12.7), labels = c(0, "4,500","15000","45,000", "125,000", "325,000"))



pingFull[!is.na(ratioAntPostCombined), .N, by = logIncome3]%>%arrange(logIncome3)


pingFull[!is.na(combinedHeadNewRO), .N, by = logIncome3]%>%arrange(logIncome3)

pingFull[!is.na(hippo.Whole.AvgRO), whole_residualized := residuals(lm(hippo.Whole.AvgRO ~ Age1 + GenderEC + DeviceSerialNumber))]


pingFull[!is.na(combinedHeadNewRO), head_residualized := residuals(lm(combinedHeadNewRO ~ Age1 + GenderEC + DeviceSerialNumber))]


grep(names(pingFull), pattern = "ratio", value = TRUE)
pingFull$combinedPosterior
ggplot(pingFull, aes(educationYears, combinedPosteriorNewRO_residualized)) +
  labs(y = "Posterior hippocampal volumes \n(mm^3; residualized for age)") +
  #geom_quasirandom(alpha = .1)+
  labs(x = "years of parental education")+
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6)+
  stat_smooth(formula = y ~ poly(x,1), method = 'lm') + 
       theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))




  
hist(pingFull$income)
hist(pingFull$logIncome)

pingFull[, logIncome := log10(income)]


pingFull[, .N, by = ethnicity]

pingFull$hippo.Whole.AvgRO

m1 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + income + educationYears, data = pingFull)
summaryh(m1)


grep(names(pingFull), value = TRUE, pattern = "educationYears")

summary(lm(combinedPosteriorNewRO ~ AgeC + educationYears, data = pingFull))



summary(lm(combinedPosteriorNewRO ~ AgeC + educationYears, data = pingFull))



summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2 + Income, data = pingFull[!is.na(combinedPosteriorNewRO)]))

```

*episodic memory measure

```{r}
pingFull[!is.na(combinedHeadNewRO) & !is.na(TBX_ibam_scr), .N]
pingFull[!is.na(combinedHead) & !is.na(TBX_VOCAB_THETA), .N]
```


```{r}
summary(lm(TBX_ibam_scr ~ Age1 + Age2 + combinedHeadNewRO + income + educationYears, data = pingFull))


summary(lm(ratioAntPostCombinedNew ~ AgeC + income + GenderEC, data = pingFull))


summary(combinedAnt)

grep(names(pingFull), pattern = "ratio", value = TRUE)

summary(lm(TBX_ibam_scr ~ Age1 + Age2 + income, data = pingFull))


summary(lm(TBX_ls ~ Age1 + Age2 + income +educationYears + GenderEC, data = pingFull))




summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2 + income, data = pingFull))

```

Age-volume relationship fdr corrections
```{r}

pValues <- c(2e-16, 2e-16, 2e-16, 2e-16, 2e-16, 2e-16, 2e-16, 8.46E-09, 1.03E-05, 1.85E-04, 0.034)
p.adjust(pValues, method = "fdr")

```


```{r}

summaryh(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO + Age1 + Age2, pingFull))
summary(lm(TBX_ls ~ hippo.Whole.AvgRO + Age1 + Age2, pingFull))
summary(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO + Age1 + Age2 , pingFull))

```


```{r}

summary(lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1 + Age2, pingFull))
summary(lm(TBX_ls ~ combinedHeadNewRO + Age1+Age2, pingFull))
summary(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + Age1 + Age2 , pingFull))


summary(lm(TBX_ibam_scr ~ combinedPosteriorNewRO + Age1 + Age2, pingFull))
summary(lm(TBX_ls ~ combinedPosteriorNewRO + Age1+Age2, pingFull))
summary(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO + Age1 + Age2 , pingFull))

summary(lm(TBX_ibam_scr ~ ratioAntPostCombinedRO + Age1 + Age2, pingFull))
summary(lm(TBX_ls ~ ratioAntPostCombinedRO + Age1+Age2, pingFull))
summary(lm(TBX_VOCAB_THETA ~ ratioAntPostCombinedRO + Age1 + Age2 + income, pingFull))

grep(names(pingFull), value =TRUE, pattern = "ratio")
```


```{r}

pvalues <- c(0.0185, 0.297, 0.004, 0.00881, 0.0163, 0.000183, 0.868, 0.501, 0.945202, 0.0782,  0.00522, 0.0108)

p.adjust(p = pvalues, method = 'fdr')

```



```{r}
m1 <- lm(combinedPosteriorNewRO ~ AgeC + educationYears1 , data = pingFull)
m2 <- lm(combinedPosteriorNewRO ~ AgeC  + educationYears1 + educationYears2, data = pingFull)
m3 <- lm(combinedPosteriorNewRO ~ AgeC  + educationYears1 + educationYears2 + educationYears3, data = pingFull)
m4 <- lm(combinedPosteriorNewRO ~ AgeC  + educationYears1 + educationYears2 + educationYears3 + educationYears4, data = pingFull)

anova(m1, m4)
AIC(m4)

```


```{r}

m1 <- lm(TBX_ibam_scr ~ Age1 + Age2 + income , pingFull)
m2 <- lm(TBX_ibam_scr ~ Age1 + Age2 + income + income2, pingFull)

anova(m1, m2)

m1 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + I(educationYears), pingFull)
m2 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + I(educationYears) + I(educationYears^2), pingFull)
m3 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + I(educationYears) + I(educationYears^2) + I(educationYears^3), pingFull)

anova(m1, m3)


pingFull[!is.na(educationYears), .N, by = educationYears]


summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + Age1 + Age2, pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO, pingFull))

```


* test way that demaster

```{r}
summary(lm(combinedHeadNewRO ~ AgeC + hippo.Whole.AvgRO, data = pingFull))
summary(lm(combinedPosteriorNewRO ~ AgeC + hippo.Whole.AvgRO, data = pingFull))


summary(lm(TBX_ibam_scrRO ~ combinedHeadNewRO + hippo.Whole.AvgRO, data = pingFull))
summary(lm(TBX_ibam_scrRO ~ combinedHeadNewRO, data = pingFull))


summary(lm(TBX_lsRO ~ combinedHeadNewRO + hippo.Whole.AvgRO, data = pingFull))
summary(lm(TBX_lsRO ~ combinedPosteriorNewRO + hippo.Whole.AvgRO, data = pingFull))
summary(lm(TBX_ls_residual))

pingFull[!is.na(TBX_ibam_scr) & !is.na(AgeC), TBX_ibam_scr_residuals := residuals(lm(TBX_ibam_scr ~ Age1 + Age2))]
pingFull[!is.na(TBX_ls) & !is.na(AgeC), TBX_ls_residuals := residuals(lm(TBX_ls ~ Age1 + Age2))]
pingFull[!is.na(TBX_VOCAB_THETA) & !is.na(Age1), TBX_VOCAB_THETA_residuals := residuals(lm(TBX_VOCAB_THETA ~ Age1 + Age2))]

summary(lm(TBX_ls_residuals ~ combinedPosteriorNewRO, data = pingFull))
```



Maybe we put both posterior and anterior in the model and see what happens... 
```{r}

summary(lm(TBX_ibam_scr ~ combinedHeadNewRO + combinedPosteriorNewRO + ratioAntPostCombinedRO + income + Age1 + Age2 + educationYears, pingFull))    ###########################



summary(lm(TBX_ls ~ combinedHeadNewRO + combinedPosteriorNewRO + ratioAntPostCombinedRO + income + Age1 + Age2 + educationYears, pingFull))

summary(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + combinedPosteriorNewRO + ratioAntPostCombinedRO + income + Age1 + Age2 + educationYears, pingFull))


toMerge<- pingFull[,.(ID, TBX_ls, TBX_ibam_scr, TBX_VOCAB_THETA, income, educationYears)]
volumes.rm2 <- left_join(volumes.rm, toMerge)

summary(lmer(TBX_ibam_scr ~ volume * region + (1|ID), data = volumes.rm2[!region == "hippo.Whole.AvgRO",] ))


```


*explore whether taking the absolute of the residuals for volume is related to memory..... 

```{r}
grep(names(pingFull), pattern = "resid", value = TRUE)

pingFull[!is.na(ratio_residualized), ratio_resid_abs := abs(ratio_residualized)]
pingFull[!is.na(combinedHeadNewRO_residualized), head_resid_abs := abs(combinedHeadNewRO_residualized)]
pingFull[!is.na(combinedPosteriorNewRO_residualized), posterior_resid_abs := abs(combinedPosteriorNewRO_residualized)]
pingFull[!is.na(hippo.Whole.AvgRO_residuals), whole_resid_abs := abs(hippo.Whole.AvgRO_residuals)]

summary(lm(TBX_ls ~ head_resid_abs * income, pingFull))
summary(lm(TBX_ibam_scr ~  head_resid_abs* income, pingFull))
summary(lm(TBX_VOCAB_THETA ~  head_resid_abs * income, pingFull))
summary(lm(TBX_ls ~ ratio_resid_abs + income, pingFull))
summary(lm(TBX_ibam_scr ~  ratio_resid_abs, pingFull))
summary(lm(TBX_VOCAB_THETA ~  ratio_resid_abs, pingFull))

ggplot(pingFull[Income == "low"], aes(head_resid_abs, TBX_ibam_scr, col = as.factor(income2)))+
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) 

ggplot(pingFull[!is.na(Income)], aes(AgeC, combinedPosteriorNewRO_residualized))+
  geom_point() +
  stat_smooth(method = 'lm', formula = y ~ poly(x,2), se = TRUE) 

```

```{r}

pingFull[!is.na(combinedHeadNewRO), head.resid_all := residuals(lm(combinedHeadNewRO ~ AgeC + GenderEC))]
pingFull[!is.na(combinedPosteriorNewRO), posterior.resid_all := residuals(lm(combinedPosteriorNewRO ~ AgeC))]

summary(lm(TBX_ibam_scr ~ posterior.resid_all, data = pingFull))
summary(lm(TBX_ibam_scr ~ abs(posterior.resid_all) + income +Age1 + Age2, data = pingFull))
summary(lm(TBX_ibam_scr ~ combinedPosteriorNewRO + income +Age1 + Age2, data = pingFull))
summary(lm(TBX_ibam_scr ~ combinedHeadNewRO + income +Age1 + Age2, data = pingFull))

summary(lm(TBX_ibam_scr ~ abs(head.resid_all) + income +Age1 + Age2, data = pingFull))

summary(lm(TBX_ibam_scr ~ posterior.resid_all + head.resid_all+ Age1 + Age2 + ratioAntPostCombined, data = pingFull))

summary(lm(TBX_ibam_scr ~ combinedPosteriorNewRO + combinedHeadNewRO + Age1 + Age2, data = pingFull))

summary(lm(TBX_ibam_scr ~ head.resid_all + Age1 + Age2, data = pingFull))
summary(lm(TBX_ibam_scr ~ abs(head.resid_all) + Age1 + Age2, data = pingFull))

summary(lm(TBX_ibam_scr ~ abs(head.resid_all), data = pingFull))

```


```{r}

summary(lm(ratioAntPostCombined ~ AgeC + combinedPosteriorNewRO + income, data = pingFull))
grep(names(pingFull), value = TRUE, pattern = "ratio")


summary(lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1 + Age2 , data = pingFull))
summary(lm(TBX_ibam_scr ~ combinedHeadNewRO + income , data = pingFull))

summary(lm(TBX_ls ~ combinedHeadNewRO + Age1 + Age2 , data = pingFull))

```




```{r}
pingFull$hippo.Whole.Avg

pingFull[!is.na(hippo.Whole.Avg), .N]
pingFull[!is.na(hippo.Whole.AvgRO), .N]
grep(names(pingFull), value = TRUE, pattern = "hippo")
```

```{r}

pingFull[Age < 5 & !is.na(TBX_ls), .(ID, Age, TBX_ls)]
summary(lm(combinedHeadNewRO ~ AgeC + hippo.Whole.AvgRO, data = pingFull))

pingFull$hippo.Whole.AvgRO


```





```{r}

pingFull[, .(income, income_dollar)]
pingFull[income == 1, income_dollar := "<5000"]
pingFull[income == 2, income_dollar := "5000 - 9999"]
pingFull[income == 3, income_dollar := "10000 - 19999"]
pingFull[income == 4, income_dollar := "20000 - 29999"]
pingFull[income == 5, income_dollar := "30000 - 39999"]
pingFull[income == 6, income_dollar := "40000 - 49999"]
pingFull[income == 7, income_dollar := "50000 - 99999"]
pingFull[income == 8, income_dollar := "100000 - 149000"]
pingFull[income == 9, income_dollar := "150000 - 199000"]
pingFull[income == 10, income_dollar := "200000 - 249000"]
pingFull[income == 11, income_dollar := "250000 - 299000"]
pingFull[income == 12, income_dollar := ">300000"]

pingFull[!is.na(combinedHeadNewRO), .N, by = .(income, income_dollar)]%>%
  arrange(income)



summary(lm(TBX_ibam_scr ~ combinedHeadNewRO + income + Age1 + Age2, pingFull))
summary(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO + income + Age1 + Age2, pingFull))


m1 <- lm(TBX_ibam_scr~ combinedHeadNewRO + Age1 + income + GenderEC, data = pingFull)
m2 <- lm(TBX_ibam_scr~ combinedHeadNewRO + Age1 + Age2 + income + GenderEC, data = pingFull)

m1 <- lm(TBX_VOCAB_THETA~ combinedHeadNewRO + Age1 + income + GenderEC, data = pingFull)
summaryh(m1)

m2 <- lm(TBX_ls~ combinedHeadNewRO + Age1 + income + GenderEC, data = pingFull)
summaryh(m2)


m1_whole <- lm(hippo.Whole.AvgRO ~ Age1 + Age2,data = pingFull)
summaryh(m1_whole) 

mem_whole <- lm(TBX_ls ~ hippo.Whole.AvgRO + AgeC * Gender + income, data = pingFull)
summaryh(mem_whole)

mem_whole_wm <- lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO + AgeC * Gender + income, data = pingFull)
summaryh(mem_whole_wm)

grep(names(pingFull), pattern= "ratio", value = TRUE)

m2 <- lm(TBX_ibam_scr ~ ratioAntPostCombined+ income + GenderEC  + AgeC, data = pingFull)
summaryh(m2)

m2 <- lm(TBX_ls ~ ratioAntPostCombined+ income  + AgeC, data = pingFull)
summaryh(m2)

m1 <- lm(TBX_VOCAB_THETA~ ratioAntPostCombined + Age1 + income + GenderEC, data = pingFull)
summaryh(m1)

m2 <- lm(TBX_ls~ combinedHeadNewRO + Age1 + income + GenderEC, data = pingFull)
summaryh(m2)


grep(names(pingFull), value = TRUE, pattern = "income")
pingFull[, .(income, incomeC, income1, income2, highIncome, Income, lowIncome, Income2, midIncome, logIncome)]

pingFull$income2 <- NULL
pingFull[income == 1, income2 := "< 5000"]
pingFull[income == 2, income2 := "5000-9999"]
pingFull[income == 3, income2 := "10000-19999"]
pingFull[income == 4, income2 := "20000-29000"]
pingFull[income == 5, income2 := "30000-39000"]
pingFull[income == 6, income2 := "40000-49000"]
pingFull[income == 7, income2 := "50000-99999"]
pingFull[income == 8, income2 := "100000-149000"]
pingFull[income == 9, income2 := "150000-199999"]
pingFull[income == 10, income2 := "200000-249000"]
pingFull[income == 11, income2 := "250000-299000"]
pingFull[income == 12, income2 := "> 300000"]

pingFull[income == 1, income3 := 4500]
pingFull[income == 2, income3 :=7500]
pingFull[income == 3, income3 := 15000]
pingFull[income == 4, income3 := 25000]
pingFull[income == 5, income3 := 35000]
pingFull[income == 6, income3 := 45000]
pingFull[income == 7, income3 := 75000]
pingFull[income == 8, income3 := 125000]
pingFull[income == 9, income3 := 175000]
pingFull[income == 10, income3 := 225000]
pingFull[income == 11, income3 := 275000]
pingFull[income == 12, income3 := 325000]


summary(lm(combinedHeadNewRO ~ log(income3) + Age1, data = pingFull))
summary(lm(combinedHeadNewRO ~ income + Age1, data = pingFull))


ggplot(pingFull, aes(income3, combinedHeadNewRO)) + 
  stat

grep(names(pingFull), value = TRUE, pattern = "shared")
pingFull[,.N, by = motion]

names(pingFull)[1000:2000]
pingFull2


scanned <- read.csv("scanned.csv")
setDT(scanned)
pingFull2 <- left_join(pingFull, scanned)

pingFull2[!is.na(scanned), mean(income3, na.rm=TRUE)]
pingFull2[!is.na(scanned), min(income3, na.rm=TRUE)]
pingFull2[!is.na(scanned), .N, by = income3]
pingFull2[!is.na(scanned), .N, by = ethnicity]%>%arrange(ethnicity)
pingFull2[, .(Manufacturer, ManufacturersModelName, DeviceSerialNumber, MMPS_version)]
pingFull2[!is.na(scanned), .N,  by = .(ManufacturersModelName, Manufacturer, DeviceSerialNumber)]

summary(lm(combinedHeadNewRO ~ Age1 + income3 + GenderEC + DeviceSerialNumber, data  = pingFull))

summary(lm(combinedHeadNewRO ~ Age1 + income + GenderEC + DeviceSerialNumber, data  = pingFull))
summary(lm(combinedHeadNewRO ~ Age1 + income + GenderEC + Manufacturer, data  = pingFull))

```


```{r}

pingFull[, .N, by = income3]%>%arrange(income3)
pingFull[, .N, by = educationYears]%>%arrange(educationYears)

summary(lm(combinedHeadNewRO ~ educationYears + Age1 + GenderEC + logIncome3, data = pingFull[educationYears >2 ]))
summary(lm(combinedHeadNewRO ~ Age1 + GenderEC + logIncome3, data = pingFull))

summary(lm(combinedPosteriorNewRO ~ educationYears + Age1 + GenderEC + logIncome3, data = pingFull[educationYears >3 ]))
summary(lm(combinedHeadNewRO ~ Age1 + GenderEC + logIncome3, data = pingFull))

ggplot(pingFull[educationYears > 3], aes(educationYears, combinedPosteriorNewRO)) + 
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6)  

ggplot(pingFull[educationYears > 3], aes(educationYears, combinedHeadNewRO)) + 
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6)  

cor.test(pingFull$income3, pingFull$Age)

plot(pingFull$income3, pingFull$Age)

ggplot(pingFull, aes(Age, logIncome3 )) + 
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6) +
  stat_smooth(method = "lm", formula = y ~ x)

cor.test(pingFull$income3, pingFull$Age)

cor.test(pingFull$logIncome3, pingFull$Age)

t.test(pingFull2[!is.na(scanned)]$income3 ~ pingFull2[!is.na(scanned)]$GenderEC)
cor.test(pingFull2[!is.na(scanned)]$income3, pingFull2[!is.na(scanned)]$ageRound)



pingFull2[!is.na(scanned) & !is.na(income3), .N,]
pingFull2[!is.na(scanned) & !is.na(income3), .N, by = Gender]
pingFull2[!is.na(scanned) & !is.na(income3), range(Age, na.rm=TRUE )]
pingFull[!is.na(income3) & !is.na(combinedHeadNewRO) & !is.na(TBX_ls) & !is.na(TBX_ibam_scr) & !is.na(TBX_VOCAB_THETA), .N]


pingFull2[!is.na(scanned) & !is.na(income3), sd(income3)]
pingFull2[!is.na(scanned) & !is.na(income3), .N, by  = ethnicity]

pingFull2[!is.na(income3) & !is.na(scanned), .N, by = motion]


pingFull2[!is.na(scanned) & !is.na(income3), sample1 := "yes"]

pingFull2[, .N, by = sample1]
pingFull2[!is.na(scanned) & !is.na(income), .N, by = sample1]
pingFull2[!is.na(scanned) & sample1 == "yes", .N ]




pingFull2[!is.na(combinedHeadNew) & !is.na(combinedPosteriorNew) & !is.na(income3), .N]
pingFull2[!is.na(combinedHeadNew) & !is.na(combinedPosteriorNew) & !is.na(income3), .N, by  = Gender]
pingFull2[!is.na(combinedHeadNew) & !is.na(combinedPosteriorNew) & !is.na(income3), range(Age, na.rm=TRUE)]

pingFull2[!is.na(scanned), .N]

pingFull2[!is.na(scanned) & !is.na(income), .N]
pingFull2[sample1 == "yes", .N]

pingFull2[sample2 == "yes", .N]


m1 <- lm(combinedHeadNewRO ~ Age1 + GenderEC + logIncome3, data = pingFull)
m2 <- lm(hippo.Whole.AvgRO ~ Age1 + GenderEC + logIncome3, data = pingFull)
summary(m2)
anova(m1, m2)


summary(lm(TBX_ibam_scr ~  ratioAntPostCombined + Age1  + DeviceSerialNumber + logIncome3 + GenderEC, pingFull))
summary(lm(TBX_ibam_scr ~ combinedPosteriorNewRO + Age1  + DeviceSerialNumber + logIncome3 + GenderEC, pingFull))
summary(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO + Age1  + Age2+ DeviceSerialNumber + logIncome3 + GenderEC, pingFull))
summary(lm(TBX_ibam_scr ~ ratioAntPostCombined + Age1 + DeviceSerialNumber + logIncome3 + GenderEC, pingFull))

pingFull$ratioAntPostCombined
```


```{r}

summary(lm(combinedHeadNewRO ~ logIncome3 + Age1+ GenderEC + DeviceSerialNumber, data= pingFull))
summaryh(lm(combinedHeadNewRO ~ logIncome3 + Age1+ GenderEC + DeviceSerialNumber, data= pingFull))

summaryh(lm(ratioAntPostCombined ~ logIncome3 + Age1+ GenderEC + DeviceSerialNumber + combinedHeadNewRO + combinedPosteriorNewRO, data= pingFull))

summary(lm(combinedPosteriorNewRO ~ logIncome3 + Age1+ GenderEC + DeviceSerialNumber, data= pingFull))
summaryh(lm(hippo.Whole.AvgRO ~ logIncome3 + Age1+ GenderEC + DeviceSerialNumber, data= pingFull))




m1 <- lm(ratioAntPostCombined ~ logIncome3 + Age1+ GenderEC + DeviceSerialNumber, data= pingFull)
summary(m1)
m2 <- lm(ratioAntPostCombined ~ logIncome3 + logIncome3_sqrd + Age1+ GenderEC+ DeviceSerialNumber , data= pingFull)
summary(m2)

anova(m1, m2)

pingFull$DeviceSerialNumber



ggplot()



summaryh(lm(combinedHeadNewRO ~ Age1 + GenderDC + DeviceSerialNumber + logIncome3, data= pingFull))
summaryh(lm(combinedPosteriorNewRO ~ Age1 + GenderDC + DeviceSerialNumber + logIncome3, data= pingFull))
summaryh(lm(ratioAntPostCombined ~ Age1 + GenderDC + DeviceSerialNumber + logIncome3 + combinedHeadNewRO, data= pingFull))

summaryh(lm(hippo.Whole.AvgRO ~ Age1+ Age2+ GenderDC + DeviceSerialNumber + logIncome3, data= pingFull))


```




```{r}
m1 <- lmer(volume ~  region + AgeC + GenderDC + logIncome3 + DeviceSerialNumber + (1|ID), data = AntPostSlopes)
summaryh(m1)

m2 <- lmer(volume ~  region * (Age1 + Age2) + (1|ID), data = AntPostSlopes)

anova(m1, m2)

AntPostSlopes <- left_join(AntPostSlopes, toMerge)
toMerge <- pingFull[, .(ID, logIncome3, GenderDC, DeviceSerialNumber)]



```



```{r}

summaryh(lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1 + logIncome3 + GenderDC, data = pingFull))
summaryh(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO + Age1 + logIncome3 + GenderDC, data = pingFull))
summaryh(lm(TBX_ibam_scr ~ combinedHeadNewRO + combinedPosteriorNewRO + Age1 + logIncome3 + GenderDC, data = pingFull))


summaryh(lm(TBX_ls ~ combinedHeadNewRO + Age1 + logIncome3 + GenderDC, data = pingFull))
summaryh(lm(TBX_ls ~ hippo.Whole.AvgRO + Age1 +logIncome3 + GenderDC, data = pingFull))
summaryh(lm(TBX_ls ~ combinedPosteriorNewRO +Age1 + logIncome3 + GenderDC, data = pingFull))
summaryh(lm(TBX_ls ~ Age1 + logIncome3 + GenderDC + combinedHeadNewRO , data = pingFull))


summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + Age1 + logIncome3 + GenderDC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO + Age1 +logIncome3 + GenderDC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO + I(combinedPosteriorNewRO^2) +Age1 + logIncome3 + GenderDC, data = pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ ratioAntPostCombined + I(ratioAntPostCombined^2)+ Age1 + logIncome3 + GenderDC, data = pingFull))

```

```{r}

grep(names(pingFull), value = TRUE, pattern = "resid")
ggplot(pingFull, aes(head_re))

```


#figure episodic memory 

```{r}
grep(names(pingFull), value = TRUE, pattern = "resid")
pingFull$ratio_residualized <- NULL

pingFull[!is.na(combinedPosteriorNewRO) & !is.na(logIncome3), posterior_residualized := residuals(lm(combinedPosteriorNewRO ~ Age1 + GenderDC + logIncome3))]

pingFull[!is.na(combinedHeadNewRO) & !is.na(logIncome3), head_residualized := residuals(lm(combinedHeadNewRO ~ Age1 + GenderDC + logIncome3))]
pingFull$ratioAntPostCombined

pingFull[!is.na(ratioAntPostCombined) & !is.na(logIncome3), ratio_residualized := residuals(lm(ratioAntPostCombined ~ Age1 + GenderDC + logIncome3))]

pingFull[!is.na(hippo.Whole.AvgRO) & !is.na(logIncome3), whole_residualized := residuals(lm(hippo.Whole.AvgRO ~ Age1 + GenderDC + logIncome3))]


head <- ggplot(pingFull, aes(head_resid_sex_plt, TBX_ibam_scr)) +
  geom_point(alpha = 0.2, color = "maroon") +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE, color = "black") +
  labs(y = "Episodic Memory score", x = "Anterior hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


posterior <- ggplot(pingFull, aes(posterior_resid_sex_plt, TBX_ibam_scr)) +
  geom_point(alpha = 0.2, color = "dark blue") +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE, color = "black") +
  labs(y = "Episodic Memory score", x = "Posterior hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

ratio <- ggplot(pingFull, aes(ratio_resid_sex_plt, TBX_ibam_scr, col= Gender)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "hAnt/hPost hippocampal ratios\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

whole <- ggplot(pingFull, aes(whole_resid_sex_plt, TBX_ibam_scr, col = Gender)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Whole hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


plot_grid(head, whole, posterior, ratio, labels = c('A', 'B', "C", "D"),align = "hv")

```



#does amy want sex as well?
```{r}
pingFull$head_resid_sex_plt <- NULL
pingFull[!is.na(combinedHeadNewRO) & !is.na(income), head_resid_sex_plt := residuals(lm(combinedHeadNewRO ~ logIncome3 + Age1 + DeviceSerialNumber))]

pingFull[!is.na(combinedPosteriorNewRO) & !is.na(income), posterior_resid_sex_plt := residuals(lm(combinedPosteriorNewRO ~ logIncome3 + Age1 + DeviceSerialNumber))]


pingFull[!is.na(hippo.Whole.AvgRO) & !is.na(income), whole_resid_sex_plt := residuals(lm(hippo.Whole.AvgRO ~ logIncome3 + Age1 + DeviceSerialNumber))]

pingFull[!is.na(ratioAntPostCombined) & !is.na(income), ratio_resid_sex_plt := residuals(lm(ratioAntPostCombined ~ logIncome3 + Age1 + DeviceSerialNumber))]



head <- ggplot(pingFull, aes(head_resid_sex_plt, TBX_ibam_scr, col = Gender)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Anterior hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


posterior <- ggplot(pingFull, aes(posterior_resid_sex_plt, TBX_ibam_scr, col = Gender)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Posterior hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

ratio <- ggplot(pingFull, aes(ratio_resid_sex_plt, TBX_ibam_scr, col= Gender)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "hAnt/hPost hippocampal ratios\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

whole <- ggplot(pingFull, aes(whole_resid_sex_plt, TBX_ibam_scr, col = Gender)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Whole hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


plot_grid(head, whole, posterior, ratio, labels = c('A', 'B', "C", "D"),align = "hv")

summary(lm(TBX_ibam_scr ~ combinedHeadNewRO * GenderEC  + logIncome3, pingFull))
m1 <- lm(TBX_ibam_scr ~ combinedHeadNewRO * GenderEC  + logIncome3,, pingFull)
m2 <- lm(TBX_ibam_scr ~ combinedHeadNewRO  + GenderEC  + logIncome3, pingFull)
anova(m1,m2)


summary(lm(combinedHeadNewRO ~ AgeC * GenderEC  + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(combinedPosteriorNewRO ~ AgeC * GenderEC  + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(hippo.Whole.AvgRO ~ AgeC * GenderEC  + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(ratioAntPostCombined ~ AgeC * GenderEC  + logIncome3 + DeviceSerialNumber, pingFull))



summary(lm(TBX_ibam_scr ~ combinedHeadNewRO * (GenderEC  * Age1) + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(TBX_ibam_scr ~ combinedPosteriorNewRO * GenderEC  * Age1 + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(TBX_ibam_scr ~ ratioAntPostCombined * GenderEC  * Age1 + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO * GenderEC  + Age1 + logIncome3 + DeviceSerialNumber, pingFull))



summary(lm(TBX_ibam_scr ~ ratioAntPostCombined * GenderEC  + Age1 + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO * GenderEC  + Age1 + logIncome3 + DeviceSerialNumber, pingFull))

summary(lm(combinedPosteriorNewRO ~ AgeC * GenderEC  + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(hippo.Whole.AvgRO ~ AgeC * GenderEC  + logIncome3 + DeviceSerialNumber, pingFull))
summary(lm(ratioAntPostCombined ~ AgeC * GenderEC  + logIncome3 + DeviceSerialNumber, pingFull))


```



#now with no residuals

```{r}
pingFull$head_resid_sex_plt <- NULL
pingFull[!is.na(combinedHeadNewRO) & !is.na(income), head_resid_sex_plt := residuals(lm(combinedHeadNewRO ~ logIncome3 + Age1 + DeviceSerialNumber))]

pingFull[!is.na(combinedPosteriorNewRO) & !is.na(income), posterior_resid_sex_plt := residuals(lm(combinedPosteriorNewRO ~ logIncome3 + Age1 + DeviceSerialNumber))]


pingFull[!is.na(hippo.Whole.AvgRO) & !is.na(income), whole_resid_sex_plt := residuals(lm(hippo.Whole.AvgRO ~ logIncome3 + Age1 + DeviceSerialNumber))]

pingFull[!is.na(ratioAntPostCombined) & !is.na(income), ratio_resid_sex_plt := residuals(lm(ratioAntPostCombined ~ logIncome3 + Age1 + DeviceSerialNumber))]



head <- ggplot(pingFull[!is.na(Income)], aes(combinedHeadNewRO, TBX_ibam_scr, col = Income)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Anterior hippocampal volumes") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


posterior <- ggplot(pingFull[!is.na(Income)], aes(combinedPosteriorNewRO, TBX_ibam_scr, col = Income)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Posterior hippocampal volumes") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

ratio <- ggplot(pingFull[!is.na(Income)], aes(ratioAntPostCombined, TBX_ibam_scr, col= Income)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "hAnt/hPost hippocampal ratios") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))

whole <- ggplot(pingFull[!is.na(Income)], aes(hippo.Whole.AvgRO, TBX_ibam_scr, col = Income)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Whole hippocampal volumes") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


plot_grid(head, whole, posterior, ratio, labels = c('A', 'B', "C", "D"),align = "hv")


```

#same for vocab

```{r}

head2 <- ggplot(pingFull, aes(head_residualized, TBX_VOCAB_THETA)) +
  geom_point(alpha = 0.2, color = "maroon") +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE, color = "black") +
  labs(y = "Vocabulary score", x = "Anterior hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


posterior <- ggplot(pingFull, aes(posterior_residualized, TBX_VOCAB_THETA)) +
  geom_point(alpha = 0.2, color = "dark blue") +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE, color = "black") +
  labs(y = "Vocabulary score", x = "Posterior hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


ratio <- ggplot(pingFull, aes(ratio_residualized, TBX_VOCAB_THETA)) +
  geom_point(alpha = 0.2, color = "purple") +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE, color = "black") +
  labs(y = "Vocabulary score", x = "hAnt/hPost hippocampal ratios\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


whole <- ggplot(pingFull, aes(whole_residualized, TBX_VOCAB_THETA)) +
  geom_point(alpha = 0.2, color = "red") +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE, color = "black") +
  labs(y = "Vocabulary score", x = "Whole hippocampal volumes\n (residuals)") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line'))


plot_grid(head2, whole, ratio, posterior, labels = c('A', 'B', "C", "D"),align = "hv")

```

```{r}

head2 <- ggplot(pingFull[!is.na(ageBins2)], aes(combinedHeadNewRO, TBX_ibam_scr, col = ageBins2)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Anterior hippocampal volumes", col = "Age") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 
  

pingFull[, ageBins2 := ageBins]
pingFull$ageBins2 <- factor(pingFull$ageBins2, levels = rev(levels(pingFull$ageBins2)))


posterior <- ggplot(pingFull[!is.na(ageBins2)], aes(combinedPosteriorNewRO, TBX_ibam_scr, col = ageBins2)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Posterior hippocampal volumes", col = "Age") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

pingFull$ageBins2 <- factor(pingFull$ageBins2, levels = rev(levels(pingFull$ageBins2)))
levels(pingFull$ageBins2)



ratio <- ggplot(pingFull[!is.na(ageBins2)], aes(ratioAntPostCombined, TBX_ibam_scr, col = ageBins2)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Hippocampal volume ratios", col = "Age") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 


whole <- ggplot(pingFull[!is.na(ageBins2)], aes(hippo.Whole.AvgRO, TBX_ibam_scr, col = ageBins2)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = 'lm', formula = y ~ x, se = TRUE) +
  labs(y = "Episodic Memory score", x = "Whole hippocampal volumes", col = "Age") +
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

pingFull$ageBins
grep(names(pingFull), value = TRUE, pattern  = "Bin")
plot_grid(head2, whole, ratio, posterior, labels = c('A', 'B', "C", "D"),align = "hv")


```


```{r}
summaryh(lm(combinedHeadNewRO ~ Age1  * GenderDC + logIncome3 + DeviceSerialNumber2, data = pingFull))

pingFull[!is.na(ratioAntPostCombined) & !is.na(Age1) & !is.na(GenderDC) & !is.na(logIncome3) & !is.na(DeviceSerialNumber2), .N]

pingFull[!is.na(combinedPosteriorNewRO) & !is.na(Age1) & !is.na(GenderDC) & !is.na(logIncome3) & !is.na(DeviceSerialNumber2), sd(Age, na.rm=TRUE)]

pingFull[!is.na(ratioAntPostCombined) & !is.na(Age1) & !is.na(GenderDC) & !is.na(logIncome3) & !is.na(DeviceSerialNumber2), range(Age, na.rm=TRUE)]

pingFull[!is.na(combinedHeadNew) & !is.na(income) & !is.na(TBX_VOCAB_THETA), .N]
pingFull[!is.na(combinedPosteriorNew)& !is.na(income)& !is.na(TBX_ibam_scr), .N]
pingFull[!is.na(hippo.Whole.Avg)& !is.na(income), .N]



pingFull$DeviceSerialNumber2 <- relevel(pingFull$DeviceSerialNumber2, "7")


Fixed.Full<-lm(sqrtClay_Tot ~ Physio.Code+ROCKTYPE1, data=PedonsTx_Reread,
+ contrasts =  list(Physio.Code = contr.sum))

pingFull[!is.na(combinedHeadNew), unique(DeviceSerialNumber2)]
pingFull[DeviceSerialNumber == "a", DeviceSerialNumber2 := "1"]
pingFull[DeviceSerialNumber == "c", DeviceSerialNumber2 := "2"]
pingFull[DeviceSerialNumber == "d", DeviceSerialNumber2 := "3"]
pingFull[DeviceSerialNumber == "f", DeviceSerialNumber2 := "4"]
pingFull[DeviceSerialNumber == "h", DeviceSerialNumber2 := "5"]
pingFull[DeviceSerialNumber == "i", DeviceSerialNumber2 := "6"]
pingFull[DeviceSerialNumber == "j", DeviceSerialNumber2 := "7"]

```

```{r}
summary(lm(TBX_ibam_scr ~ combinedHeadNewRO * (GenderEC + Age1) + logIncome3, pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO * (GenderEC + Age1) + logIncome3, pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO * (GenderEC + Age1) + logIncome3, pingFull))
summaryh(lm(TBX_VOCAB_THETA ~ ratioAntPostCombinedRO * (GenderEC + Age1) + logIncome3, pingFull))






summary(lm(TBX_ibam_scr ~ Age1 + combinedPosteriorNewRO + logIncome3, pingFull[Age > 16]))



summary(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO * (GenderDC + Age1)  + logIncome3, pingFull))
summary(lm(TBX_ibam_scr ~ combinedHeadNewRO * (GenderEC + Age1) + logIncome3, pingFull))


summary(model.y)


summary(lm(TBX_ibam_scr ~ combinedHeadNewRO * (GenderDC + AgeC)  + logIncome3, pingFull))
summary(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO * (GenderDC + AgeC) + logIncome3, pingFull))
summary(lm(TBX_ibam_scr ~ combinedPosteriorNewRO * (GenderDC + AgeC)  + logIncome3, pingFull))
summary(lm(TBX_ibam_scr ~ ratioAntPostCombined * (GenderDC + AgeC) + logIncome3, pingFull))

```

```{r}

pingFull[!is.na(income) & !is.na(combinedHeadNew), .N]
pingFull[, .(Age1, Age2, AgeC, Age)]

pingSubset <- pingFull[!is.na(income) & !is.na(combinedHeadNew)]
dim(pingSubset)

#create centered age variable based on my new population subset
pingFull[, .(Age, AgeC, Age1, Age2)]
pingFull[, mean(Age, na.rm=TRUE)]
pingSubset[, AgeC := Age - mean(Age, na.rm=TRUE)]
pingSubset[, Age1 := AgeC/10]
pingSubset[, Age2 := Age1^2]

```


```{r}
head <- lm(combinedHeadNewRO ~ AgeC + income + GenderEC, data = pingSubset)
head2 <- lm(combinedHeadNewRO ~ Age1 + Age2 + income + GenderEC, data = pingSubset)

posterior <- lm(combinedPosteriorNewRO ~ AgeC + income + GenderEC, data = pingSubset)
posterior2 <- lm(combinedPosteriorNewRO ~ Age1 + Age2 + income + GenderEC, data = pingSubset)

whole <- lm(hippo.Whole.AvgRO ~ AgeC + income + GenderEC, data = pingSubset)
whole2 <- lm(hippo.Whole.AvgRO ~ Age1 + Age2 + income + GenderEC, data = pingSubset)
anova(whole, whole2)

```


```{r}
summary(lm(TBX_ibam_scr ~ hippo.Whole.AvgRO  + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset))
summary(lm(TBX_ibam_scr ~ combinedPosteriorNewRO + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset))
summary(lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset))
summary(lm(TBX_ibam_scr ~ ratioAntPostCombined + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset))


m1 <- lm(TBX_ibam_scr ~ hippo.Whole.AvgRO + I(hippo.Whole.AvgRO^2) + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset)
m2 <- lm(TBX_ibam_scr ~ hippo.Whole.AvgRO + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset)
summary(m1)
summary(m2)
anova(m1, m2)


ggplot(pingSubset[Age < 21], aes(Age, TBX_ibam_scr )) +
  stat_smooth(method = 'lm', formula = y~ x) + 
  geom_point()


m1 <- lm(TBX_ibam_scr ~ Age1 , data = pingSubset[Age < 11])
summary(m1)
m2 <- lm(TBX_ibam_scr ~ Age1 + Age2, data = pingSubset[Age < 11])
summary(m2)
anova(m1, m2)


m2 <- lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1 +  Age2 + GenderEC , data = pingSubset)
anova(m1, m2)

```

```{r}
summary(lm(TBX_VOCAB_THETA ~ hippo.Whole.AvgRO + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset))
summary(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset))
summary(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset))
summary(lm(TBX_VOCAB_THETA ~ ratioAntPostCombined + Age1  + Age2 + logIncome3 + GenderEC, data = pingSubset))

```


#long form

```{r}
pingSubsetWide <- pingSubset[, .(ID, combinedHeadNewRO, combinedPosteriorNewRO, ratioAntPostCombined, hippo.Whole.AvgRO, AgeC, Age1, Age2, Age, income, logIncome3, GenderEC, GenderDC)]

pingSubsetLong <- gather(pingSubsetWide, region, volume, combinedHeadNewRO:combinedPosteriorNewRO)

mixedEffects <- lmer(volume ~ region * (Age1  + Age2) + logIncome3+ GenderEC+ (1|ID), data = pingSubsetLong)
summary(mixedEffects)

mixedEffects2 <- lmer(volume ~ region * Age1 + logIncome3+ GenderEC+ (1|ID), data = pingSubsetLong)
summary(mixedEffects2)

mixedEffects3 <- lmer(volume ~ region * logIncome3 + GenderEC+ AgeC + DeviceSerialNumber +  (1|ID), data = pingSubsetLong)
summary(mixedEffects3)

summary(lm(income ~ combinedPosteriorNewRO + combinedHeadNewRO + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset))

summaryh(lm(income ~ combinedPosteriorNewRO + combinedHeadNewRO + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset))

pingSubset[!is.na(income) & !is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO) & !is.na(GenderEC) & !is.na(DeviceSerialNumber),.N]

```



#mediation
```{r}



model.y <- lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + GenderEC + AgeC + income3, data = pingSubset[!is.na(DeviceSerialNumber)])
summary(model.y)

model.m <- lm(combinedHeadNewRO ~ income3 + AgeC + DeviceSerialNumber + GenderEC, data = pingSubset[!is.na(TBX_ibam_scr)])
summary(model.m)

model.mediate <- mediate(model.m = model.m, model.y = model.y, sims = 5000, treat = "income3", mediator = "combinedHeadNewRO",boot = TRUE)
summary(model.mediate)

grep(names(pingSubset), pattern = "Income", value = TRUE)
pingSubset[, .(income, incomeC, income1, income2, income3)]

#acme: mediated (ab) effect
#ade: direct effect (c')
#total effect: c

"This analysis revealed that group affected mean accuracy as a function of its relationship 
with percent out, ab =-0.00650, SE = 0.001897814 , 95% CI [-0.01045, 0]. Although the total effect of percent out on accuracy was significant, c = -0.01068, SE = 0.002168114 , 95% CI [-0.01503,  -0.01], 
the direct effect of group on accuracy was not significant when the indirect path through 
percent out was taken into account, c’ = -0.00419 , SE = 0.002686647 , 95% CI [-0.00943,  0]. 
This analysis suggests that group predicts the acc
because of its co-occurrence with percent out.”"



mediation.data <- data.frame(AgeC = pingSubset$acetic.acid, lactic.acid = cheese.data$lactic.acid, hydrogen.sulphide = cheese.data$hydrogen.sulphide, taste = cheese.data$taste)
datasets <- list(dataset = mediation.data)

multiple.mediation <- mediations(datasets, "acetic.acid", c("lactic.acid", "hydrogen.sulphide"), "taste", sims = 1000)
augmented.summary(multiple.mediation) #Liz's function to show SE
summary(multiple.mediation) 

```


```{r}

#vocab
model.y_vocab <- lm(TBX_VOCAB_THETA ~ logIncome3 + Age1+Age2 + combinedHeadNewRO + GenderEC, data = pingSubset)
summary(model.y_vocab)

model.m_vocab <- lm(combinedHeadNewRO ~ logIncome3 + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(TBX_VOCAB_THETA)])
summary(model.m_vocab)

model.mediate_vocab <- mediate(model.m = model.m_vocab, model.y = model.y_vocab, sims = 5000, treat = "logIncome3", mediator = "combinedHeadNewRO")
summary(model.mediate_vocab)


#episodic
model.y_episodic <- lm(TBX_ibam_scr ~ logIncome3 + Age1 + Age2 + GenderEC + combinedHeadNewRO, data = pingSubset)
summary(model.y_episodic)

model.m_episodic <- lm(combinedHeadNewRO ~ logIncome3 + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(TBX_ibam_scr)])

summary(model.m_episodic)
model.mediate_episodic <- mediate(model.m = model.m_episodic, model.y = model.y_episodic, sims = 5000, treat = "logIncome3", mediator = "combinedHeadNewRO")
summary(model.mediate_episodic)

```

```{r}

#vocab
model.y_vocab.age <- lm(TBX_VOCAB_THETA ~ logIncome3 + Age1+Age2 + combinedHeadNewRO + GenderEC, data = pingSubset)
summary(model.y_vocab.age)

model.m_vocab.age <- lm(combinedHeadNewRO ~ logIncome3 + Age1 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(TBX_VOCAB_THETA)])
summary(model.m_vocab.age)

model.mediate_vocab.age <- mediate(model.m = model.m_vocab.age, model.y = model.y_vocab.age, sims = 5000, treat = "Age1", mediator = "combinedHeadNewRO")
summary(model.mediate_vocab.age)


#episodic
model.y_episodic.age <- lm(TBX_ibam_scr ~ logIncome3 + Age1 + Age2 + GenderEC + combinedHeadNewRO, data = pingSubset)
summary(model.y_episodic.age)

model.m_episodic.age <- lm(combinedHeadNewRO ~ logIncome3 + Age1 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(TBX_ibam_scr)])

summary(model.m_episodic.age)
model.mediate_episodic.age <- mediate(model.m = model.m_episodic.age, model.y = model.y_episodic.age, sims = 5000, treat = "Age1", mediator = "combinedHeadNewRO")

summary(model.mediate_episodic.age)

```


```{r}
m1 <- lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1 + Age2 + GenderEC + logIncome3, data = pingSubset)
summary(m1)
vcov(m1)
m2 <- lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1 + Age2 + GenderEC + logIncome3, data = pingSubset)
summary(m2)
cov2cor(vcov(m1)) 


m1 <- lm(TBX_ibam_scr ~ Age1 + Age2 + Age3 + Age4 + GenderEC + combinedHeadNewRO + logIncome3, pingFull)
m2 <- lm(TBX_ibam_scr ~ Age1 + Age2 + Age3 + GenderEC + combinedHeadNewRO + logIncome3, pingFull)
anova(m1, m2)
summary(m2)


summary(lm(TBX_ibam_scr ~ Age1 + Age2 + Age3 + GenderEC + logIncome3 + GenderEC, pingFull))
m1 <- lm(TBX_ibam_scr ~ Age1 + Age2 + GenderEC + combinedHeadNewRO + logIncome3, pingFull)
m2 <- lm(TBX_ibam_scr ~ Age1 + GenderEC + combinedHeadNewRO + logIncome3, pingFull)
anova(m1, m2)

m1 <- lm(TBX_ibam_scr ~ Age1 + Age2 + Age3 + GenderEC + combinedHeadNewRO, pingSubset)
m2 <- lm(TBX_ibam_scr ~ Age1 + Age2  + GenderEC + combinedHeadNewRO, pingSubset)
anova(m1, m2)

m1 <- lm(TBX_ibam_scr ~ Age1 + Age2+ Age3 +GenderEC + ratioAntPostCombined, pingSubset)
m2 <- lm(TBX_ibam_scr ~ Age1 + Age2 +GenderEC + ratioAntPostCombined, pingSubset)
anova(m1, m2)

m1 <- lm(TBX_ibam_scr ~ Age1 + Age2 + Age3 +GenderEC + hippo.Whole.AvgRO, pingSubset)
m2 <- lm(TBX_ibam_scr ~ Age1 + Age2 +GenderEC + hippo.Whole.AvgRO, pingSubset)
anova(m1, m2)

summary(lm(TBX_ls ~ Age1 + Age2 + Age3 +GenderEC + combinedPosteriorNewRO, pingSubset))






summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2 + GenderEC + combinedHeadNewRO, pingSubset))
summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2 + GenderEC + ratioAntPostCombined, pingSubset))
summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2 + GenderEC + hippo.Whole.AvgRO, pingSubset))
summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2 + GenderEC + combinedPosteriorNewRO, pingSubset))


summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2+ GenderEC + hippo.Whole.AvgRO, pingSubset))
summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2 + GenderEC + ratioAntPostCombined , pingSubset))
summary(lm(TBX_VOCAB_THETA ~ Age1 + Age2+ GenderEC + combinedHeadNewRO, pingSubset))
summary(lm(TBX_ls ~ Age1 + Age2 + GenderEC + combinedPosteriorNewRO , pingSubset))



summary(lm(TBX_ls ~ Age1 + Age2+ Age3 + GenderEC + hippo.Whole.AvgRO, pingSubset))
summary(lm(TBX_ls ~ Age1 + Age2 + Age3  +GenderEC + ratioAntPostCombined , pingSubset))
summary(lm(TBX_ls ~ Age1 + Age2+ Age3  +GenderEC + combinedHeadNewRO, pingSubset))
summary(lm(TBX_ls ~ Age1 + Age2 + Age3  +GenderEC + combinedPosteriorNewRO , pingSubset))

```


```{r}

ggplot(pingFull, aes(Age, TBX_ibam_scr)) + 
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ poly(x,1))

```




```{r}
m1 <- lm(TBX_ibam_scr ~ Age1 + Age2 + Age3 + GenderEC + logIncome3, data = pingSubset[!is.na(combinedHeadNew)])

m2 <- lm(TBX_ibam_scr ~ Age1 + Age2  + GenderEC + logIncome3, data = pingSubset[!is.na(combinedHeadNew)])

anova(m1,m2)

summary(hippo.Whole.)


```



```{r}

summary(lm(combinedHeadNewRO ~ AgeC * income, data = pingSubset))

grep(names(pingSubset), pattern = "Gua", value = TRUE)

summary(lm(combinedHeadNewRO ~ FDH_Guardian_1_Ocup + AgeC, data = pingSubset))

summary(lm(hippo.Whole.AvgRO ~ AgeC + GenderEC  + DeviceSerialNumber + FDH_Guardian_1_Ocup  , data = pingSubset))


pingSubset[!is.na(avgParentEdu2), .N, by = avgParentEdu2]%>%arrange(avgParentEdu2)



cor.test(pingSubset$logIncome3, pingSubset$occupation)
cor.test(pingSubset$avgParentEdu2, pingSubset$occupation)

grep(names(pingFull), value = TRUE, pattern = "Edu")

pingSubset[, .(occupation)]


```


#ses findings
```{r}

summary(lm(combinedHeadNew ~ logOccuptation * AgeC * GenderEC + DeviceSerialNumber, data = pingSubset))

summary(lm(ratioAntPostCombined ~ logOccuptation * AgeC * GenderEC + DeviceSerialNumber, data = pingSubset))

summary(lm(hippo.Whole.AvgRO ~ logOccuptation * AgeC * GenderEC + DeviceSerialNumber, data = pingSubset))

summary(lm(combinedPosteriorNewRO ~ logOccuptation * AgeC * GenderEC + DeviceSerialNumber, data = pingSubset))


summary(lm(TBX_ibam_scr ~ combinedHeadNewRO + Age1 + Age2 + Age3  + DeviceSerialNumber + GenderEC + occupation, data = pingSubset))


summary(lm(TBX_VOCAB_THETA ~ logIncome3 + combinedHeadNewRO + DeviceSerialNumber + GenderEC, data = pingSubset))

summary(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + logIncome3 + GenderEC + DeviceSerialNumber + Age1 + Age2 + Age3, data = pingSubset))

hist(pingSubset$logOccuptation)
pingSubset[, logOccuptation := log(occupation)]


summary(lm(income ~ AgeC, data = pingSubset))


```


#what about pairing the data?
```{r}

pingSubset[, .N, by = .(roundAge,  income)]%>%arrange(roundAge)%>%print(n=Inf)


pingSubset[, unique(income)]

m1 <- lm(TBX_ls ~ I(sqrt(Age)), data = pingSubset)

m2 <- lm(TBX_ls ~ Age1 + Age2, data = pingSubset)
m3 <- lm(TBX_ls ~ Age1 + Age2 + Age3 + Age4, data = pingSubset)
anova(m1, m2)


pingSubset[, Age4 := Age1^4]
BIC(m1)
BIC(m2)

```



```{r}
summary(lm(logIncome3 ~ combinedHeadNewRO + combinedPosteriorNewRO + AgeC, data  = pingSubset))
summary(lm(combinedHeadNewRO ~ logIncome3 +  AgeC, data  = pingSubset))
summary(lm(combinedPosteriorNewRO ~ logIncome3 +  AgeC, data  = pingSubset))



summary(lm(logIncome3 ~  combinedPosteriorNewRO +AgeC, data  = pingSubset))

summary(lm(combinedPosteriorNewRO ~  logIncome3 + Age1, data  = pingSubset))


install.packages("")
#do.by

```

Paper analyses

```{r}

summary()

install.packages("mvnormtest")
library(mvnormtest)

#does income affect posterior and anterior volumes or just one?
# do an manova

manova.vols <- lm(cbind(combinedHeadNewRO, combinedPosteriorNewRO, ratioAntPostCombined, hippo.Whole.AvgRO) ~ logIncome3 + AgeC + DeviceSerialNumber + GenderEC, data = pingSubset)
summary(manova.vols)
summary(lm(hippo.Whole.AvgRO ~ logIncome3 + AgeC + DeviceSerialNumber + GenderEC, data = pingSubset))
library(car)
Anova(manova.vols)


manova.Mem <- manova(cbind(TBX_ls, TBX_ibam_scr, TBX_VOCAB_THETA) ~ logIncome3 + AgeC+ combinedHeadNewRO + combinedPosteriorNewRO +ratioAntPostCombined+ GenderEC, data = pingSubset)

summary(manova.Mem)
summary.aov(manova.Mem)


summary(lm(combinedPosteriorNewRO ~ logIncome3 + AgeC + DeviceSerialNumber + GenderEC, data = pingSubset))

#do a lm
summary(lm(logIncome3 ~ combinedHeadNewRO + combinedPosteriorNewRO + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset))

summary(lm(logIncome3 ~ combinedHeadNewRO + combinedPosteriorNewRO + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset))


#do a lmer
summary(lmer(volume ~  region * AgeC + (1|ID), data = AntPostSlopes))

summaryh(lmer(volume ~ logIncome3 * region + AgeC + DeviceSerialNumber+Gender + (1|ID), data = AntPostSlopes))

class(AntPostSlopes$logIncome3)


AntPostSlopes[region == "combinedHeadNewRO", region_EC := -1]
AntPostSlopes[region == "combinedPosteriorNewRO", region_EC := 1]
AntPostSlopes[GenderDC == 0, GenderEC := -1]
AntPostSlopes[GenderDC == 1, GenderEC := 1]

AntPostSlopes[region == "combinedPosteriorNewRO", region_EC := 1]

summaryh(lm(logIncome3 ~ combinedHeadNewRO + combinedPosteriorNewRO + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset))




```


```{r}

ami_data <- read.table("http://static.lib.virginia.edu/statlab/materials/data/ami_data.DAT")
names(ami_data) <- c("TOT","AMI","GEN","AMT","PR","DIAP","QRS")
mlm1 <- lm(cbind(TOT, AMI) ~ GEN + AMT + PR + DIAP + QRS, data = ami_data)
summary(mlm1)


vcov(mlm1)

summary(lm(occupation ~ income, pingFull[!is.na(combinedHeadNew)]))


pingSubset[Age %in% c(7,8,9,10), group := "kid"]
pingSubset[Age %in% c(8,9,10) & income > 8, group := "highSES_kid"]

pingSubset[Age > 17, group := "adult"]

summary(lm(TBX_ibam_scr ~ group, data = pingSubset))
pingSubset[, unique(income)]


```

```{r}
summary(lm(combinedHeadNewRO ~ AgeC + income + GenderEC))

pingSubset[, .(Gender, GenderEC)]

pingSubset[is.na(occupation), .N]

toBind <- pingFull[is.na(income) & !is.na(occupation) & !is.na(combinedHeadNewRO)]

summary(lm(combinedHeadNewRO ~ AgeC + occupation + logIncome3+GenderEC + DeviceSerialNumber2, data = pingSubset))
summary(lm(combinedHeadNewRO ~ AgeC * occupation + GenderEC + DeviceSerialNumber2, data = pingSubset))

````


#number included in sample, after removal due to noise
```{r}
pingSubset[, .N]

m1 <- lm(combinedHeadNewRO ~ AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset)
m2 <- lm(combinedHeadNewRO ~ Age1 + Age2 + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset)
anova(m1, m2)


m1P <- lm(combinedPosteriorNewRO ~ AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset)
m2P <- lm(combinedPosteriorNewRO ~ Age1 + Age2+ logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset)
m2P3 <- lm(combinedPosteriorNewRO ~ Age1 + Age2 + Age3+ logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset)

anova(m2P3, m2P)


```


#models

```{r}

#first set of analyses
#check number in sample
pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO) & !is.na(logIncome3) & !is.na(AgeC) & !is.na(GenderEC) & !is.na(DeviceSerialNumber), .N]

#first set analysis
#Does income predict volumes, while controlling for ... 
summary(lm(combinedHeadNewRO ~ logIncome3 + AgeC + GenderEC  +  DeviceSerialNumber, data = pingSubset[!is.na(combinedPosteriorNewRO)]))

#Does income predict posterior volumes, controlling for... 
summary(lm(combinedPosteriorNewRO ~ logIncome3 + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO)]))

toGather <- pingSubset[, .(ID, combinedPosteriorNewRO, combinedHeadNewRO, logIncome3, AgeC, GenderEC, DeviceSerialNumber)]

#now do for whole hippocampus
pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO) & !is.na(hippo.Whole.Avg), .N]
pingSubset[, .(combinedPosteriorNewRO, combinedHeadNewRO, hippo.Whole.Avg)]
summary(lm(hippo.Whole.Avg ~ logIncome3 + AgeC + GenderEC  +  DeviceSerialNumber, data = pingSubset))



#second set analysis
#does income predict volumes in anterior better than posterior
dfLong <- gather(toGather, region, volume, -c(ID, AgeC, logIncome3, GenderEC, DeviceSerialNumber))
setDT(dfLong)
dfLong[region == "combinedHeadNewRO", region_EC := 1]
dfLong[region == "combinedPosteriorNewRO", region_EC := -1]

#this is asking whether at different levels of income there are different volumes in anterior and posterior
#exclude participants without two measures
dfLong[is.na(volume)]
dfLong[ID %in% c("p0124", "p0160", "p0984", "p1016", "p0294", "p0973", "p1380")]
dfLong[ID %in% c("p0124", "p0160", "p0984", "p1016", "p0294", "p0973", "p1380"), `:=` (ID = NA, logIncome3 = NA, region = NA, volume = NA)]
dfLong <- dfLong[!is.na(volume)]
dim(dfLong)

summaryh(lmer(volume ~ region_EC * logIncome3 + AgeC + GenderEC +  DeviceSerialNumber + (1|ID), data = dfLong))
summaryh(lmer(volume ~ region * logIncome3 + AgeC + GenderEC +  DeviceSerialNumber + (1|ID), data = dfLong))

#this is asking whether one is more influenced than another...
summary(lm(logIncome3 ~ combinedHeadNewRO + combinedPosteriorNewRO + AgeC + GenderEC + DeviceSerialNumber, data = pingSubset))
summary(aov(logIncome3 ~ DeviceSerialNumber, data = pingSubset))

pingSubset[!is.na(TBX_ibam_scr), .N]
pingSubset[!is.na(TBX_VOCAB_THETA), .N]
pingSubset[, .(DeviceSerialNumber, logIncome3)]

#second
#do volumes predict episodic memory and vocabulary scores
summaryh(lm(TBX_ibam_scr ~ combinedHeadNewRO + logIncome3 + AgeC + GenderEC, data = pingSubset[!is.na(combinedPosteriorNewRO)]))

summaryh(lm(TBX_ibam_scr ~ combinedPosteriorNewRO + logIncome3 + AgeC + GenderEC, data = pingSubset[!is.na(combinedHeadNewRO)]))

summaryh(lm(TBX_ibam_scr ~ combinedPosteriorNewRO + combinedHeadNewRO + logIncome3 + AgeC + GenderEC, data = pingSubset[!is.na(combinedPosteriorNewRO)]))

summaryh(lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + logIncome3 + AgeC + GenderEC, data = pingSubset[!is.na(combinedPosteriorNewRO)]))

summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO + logIncome3 + AgeC + GenderEC, data = pingSubset[!is.na(combinedHeadNewRO)]))

summaryh(lm(TBX_VOCAB_THETA ~ combinedPosteriorNewRO + combinedHeadNewRO + logIncome3 + AgeC + GenderEC, data = pingSubset[!is.na(combinedPosteriorNewRO)]))


#income predicts episodic memory and vocabulary???
summaryh(lm(TBX_ibam_scr ~ logIncome3 + AgeC + GenderEC, data = pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO)]))

summaryh(lm(TBX_VOCAB_THETA ~ logIncome3 + AgeC + GenderEC, data = pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO)]))




#third
#mediation model
model.y_episodic <- lm(TBX_ibam_scr ~ combinedHeadNewRO + GenderEC + AgeC + logIncome3, data = pingSubset[!is.na(combinedPosteriorNewRO)])
summary(model.y_episodic)

model.y_episodic_z <- lm(TBX_ibam_scr_z ~ combinedHeadNewRO_z + GenderEC + Age_z + logIncome3_z, data = pingSubset[!is.na(combinedPosteriorNewRO)])
summary(model.y_episodic_z)

model.m_episodic_z <- lm(combinedHeadNewRO_z ~logIncome3_z + Age_z + DeviceSerialNumber + GenderEC, data = pingSubset[!is.na(TBX_ibam_scr) & !is.na(combinedPosteriorNewRO)])
summary(model.m_episodic_z)

model.mediate_episodic_z <- mediate(model.m = model.m_episodic_z, model.y = model.y_episodic_z, sims = 5000, treat = "logIncome3_z", mediator = "combinedHeadNewRO_z",boot = TRUE, covariates = c("GenderEC", "Age_z", "DeviceSerialNumber"))

summary(model.mediate_episodic)
standard.errors(model.mediate_episodic_z)

summary(model.m_episodic)
lm.beta(model.m_episodic)

summary(model.y_episodic)
lm.beta(model.y_episodic)


#acme: mediated (ab) effect
#ade: direct effect (c')
#total effect: c

"This analysis revealed that group affected mean accuracy as a function of its relationship with percent out, ab =-0.00650, SE = 0.001897814 , 95% CI [-0.01045, 0]. Although the total effect of percent out on accuracy was significant, c = -0.01068, SE = 0.002168114 , 95% CI [-0.01503,  -0.01], 
the direct effect of group on accuracy was not significant when the indirect path through 
percent out was taken into account, c’ = -0.00419 , SE = 0.002686647 , 95% CI [-0.00943,  0]. 
This analysis suggests that group predicts the acc because of its co-occurrence with percent out.”"


#fourth analysis
#mediation model
model.y_vocab <- lm(TBX_VOCAB_THETA ~ combinedHeadNewRO + GenderEC + AgeC + logIncome3, data = pingFull[!is.na(combinedPosteriorNewRO)])
summary(model.y_vocab)

pingSubset$TBX_VOCAB_THETA_z
model.y_vocab_z <- lm(TBX_VOCAB_THETA_z ~ combinedHeadNewRO_z + GenderEC + Age_z + logIncome3_z, data = pingSubset[!is.na(combinedPosteriorNewRO)])
summary(model.y_vocab_z)

model.m_vocab_z<- lm(combinedHeadNewRO_z ~logIncome3_z + Age_z + DeviceSerialNumber + GenderEC, data = pingSubset[!is.na(TBX_VOCAB_THETA) & !is.na(combinedPosteriorNewRO)])
summary(model.m_vocab_z)

model.mediate_vocab_z <- mediate(model.m = model.m_vocab_z, model.y = model.y_vocab_z, sims = 5000, treat = "logIncome3_z", mediator = "combinedHeadNewRO_z")

summary(model.mediate_vocab)

summary(model.m_vocab)
lm.beta(model.m_vocab)

summary(model.y_vocab)
lm.beta(model.y_vocab)
standard.errors(model.mediate_vocab_z)

library('lm.beta')

#acme: mediated (ab) effect
#ade: direct effect (c')
#total effect: c

"This analysis revealed that group affected mean accuracy as a function of its relationship with percent out, ab =-0.00650, SE = 0.001897814 , 95% CI [-0.01045, 0]. Although the total effect of percent out on accuracy was significant, c = -0.01068, SE = 0.002168114 , 95% CI [-0.01503,  -0.01], 
the direct effect of group on accuracy was not significant when the indirect path through 
percent out was taken into account, c’ = -0.00419 , SE = 0.002686647 , 95% CI [-0.00943,  0]. 
This analysis suggests that group predicts the acc because of its co-occurrence with percent out.”"

```



```{r}
ggplot(pingSubset, aes(income, combinedHeadNewRO)) +
  stat_smooth(formula = y ~ x, method = 'lm') + 
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6)

```

```{r}
ggplot(pingSubset, aes(income, combinedPosteriorNewRO)) +
  stat_smooth(formula = y ~ x, method = 'lm') + 
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6)

```


```{r}
pingSubset[!is.na(TBX_ibam_scr), episodic_memory_residuals_age := residuals(lm(TBX_ibam_scr ~ AgeC))]
pingSubset[!is.na(TBX_VOCAB_THETA), vocab_residuals_age := residuals(lm(TBX_VOCAB_THETA ~ AgeC))]

grep(names(pingSubset), pattern = "resi", value  = TRUE)

ggplot(pingSubset, aes(income, episodic_memory_residuals_age)) +
  stat_smooth(formula = y ~ x, method = 'lm') + 
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6)

summary(lm(TBX_ibam_scr ~ income + AgeC + GenderEC, data   = pingSubset[income < 11]))

ggplot(pingSubset, aes(income, vocab_residuals_age)) +
  stat_smooth(formula = y ~ x, method = 'lm') + 
 stat_summary(fun.y = mean, geom = "point", size = 1) +
   stat_summary(fun.data = mean_se, geom = "errorbar", width = 0, size = .6)

```


```{r}
summary(lm(TBX_ibam_scr ~ combinedPosteriorNewRO + combinedHeadNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset))


summary(lm(TBX_ibam_scr ~  combinedHeadNewRO * AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset))
summary(lm(TBX_ibam_scr ~  combinedPosteriorNewRO * Age1 + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset))


```



#figures for paper

```{r}

pingSubset[, .(income, logIncome3, income, income1, income2, income3, Income, logIncome, logIncome3_sqrd,FDH_3_Household_Income )]
pingSubset[income3 == 325000, range(TBX_ibam_scr)]

grep(names(pingSubset), pattern = "income3", value = TRUE)

pingSubset[!is.na(TBX_ibam_scr), .N, by = income3]

ggplot(pingSubset, aes(income3, TBX_ibam_scr)) +
  geom_jitter(alpha = .3,show.legend = FALSE, size = 3, width = .95, height = .95)+
  geom_smooth(method = 'lm', formula = y ~ log(x), se = TRUE, shape =1) +
  labs(y = "Episodic memory performance", x = 'Income') + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(breaks = c(4500, 15000, 25000,35000,  45000,  75000,125000, 175000, 225000,   275000, 325000), labels = c( "4,500","15000","25,000", "35,000","45,000", "75,000","125,000","175,000", "225,000","275000", "325,000"))
  


```


```{r}

grep(names(pingSubset), pattern = "resi", value = TRUE)
pingSubset[!is.na(TBX_ibam_scr),TBX_ibam_scr_residuals := residuals(lm(TBX_ibam_scr ~ GenderEC + AgeC))]

ggplot(pingSubset, aes(income3, TBX_ibam_scr_residuals)) +
  geom_jitter(show.legend = FALSE, size = 3, shape = 21)+
  geom_smooth(method = 'lm', formula = y ~ log(x), se = TRUE, shape =1) +
  labs(y = "Episodic memory performance", x = 'Income') + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 0.5, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 0.5, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 12, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(breaks = c(4500, 45000,  75000,125000, 175000, 225000,   275000, 325000), labels = c( "4,500", "45,000", "75,000","125,000","175,000", "225,000","275,000", "325,000"))

pingSubset[, .(income3)]
```


#figure 1a

```{r}
episodic_residuals <- ggplot(pingSubset, aes(income3, TBX_ibam_scr_residuals)) +
  geom_jitter(show.legend = FALSE, size = 3, shape = 21)+
  geom_smooth(method = 'lm', formula = y ~ log(x), se = TRUE, shape =1, color = "purple") +
  labs(y = "Adjusted episodic memory \nperformance", x = 'Income (thousands, USD)') + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 16, colour = 'black'), 
        axis.text.y = element_text(size = 16, colour = 'black'), 
        plot.title = element_text(size = 16, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(breaks = c(0, 50000, 100000, 150000, 200000, 250000, 300000, 350000), labels = c( "0", "50", "100", "150", "200", "250","300", "350"))


```


#z scores

```{r}
pingSubset[!is.na(TBX_ibam_scr), episodic_zscores := scale(TBX_ibam_scr_residuals)]

episodic_z <- ggplot(pingSubset, aes(income3, episodic_zscores)) +
  geom_jitter(show.legend = FALSE, size = 3, shape = 21)+
  geom_smooth(method = 'lm', formula = y ~ log(x), se = TRUE, shape =1, color = "purple") +
  labs(y = "Adjusted episodic memory \nperformance (z-scores)", x = 'Income (thousands, USD)') + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 16, colour = 'black'), 
        axis.text.y = element_text(size = 16, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(breaks = c(0, 50000, 100000, 150000, 200000, 250000, 300000, 350000), labels = c( "0", "50", "100", "150", "200", "250","300", "350")) +
   scale_y_continuous(breaks=seq(-3, 4, 1))

```



#figure 1b

```{r}

pingSubset[!is.na(TBX_VOCAB_THETA), TBX_VOCAB_THETA_residuals := residuals(lm(TBX_VOCAB_THETA~ GenderEC + AgeC))]

vocab_residuals <- ggplot(pingSubset, aes(income3, TBX_VOCAB_THETA_residuals)) +
  geom_jitter(show.legend = FALSE, size = 3, shape = 21)+
  geom_smooth(method = 'lm', formula = y ~ log(x), se = TRUE, shape =1, color = "darkgreen") +
  labs(y = "Adjusted vocabulary \nperformance", x = 'Income (thousands, USD)') + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 16, colour = 'black'), 
        axis.text.y = element_text(size = 16, colour = 'black'), 
        plot.title = element_text(size = 16, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(breaks = c(0, 50000, 100000, 150000, 200000, 250000, 300000, 350000), labels = c( "0", "50", "100", "150", "200", "250","300", "350"))


```



```{r}
pingSubset[!is.na(TBX_VOCAB_THETA_residuals), vocab_z := scale(TBX_VOCAB_THETA_residuals)]

vocab_z <- ggplot(pingSubset, aes(income3, vocab_z)) +
  geom_jitter(show.legend = FALSE, size = 3, shape = 21)+
  geom_smooth(method = 'lm', formula = y ~ log(x), se = TRUE, shape =1, color = "darkgreen") +
  labs(y = "Adjusted vocabulary \nperformance (z-scores)", x = 'Income (thousands, USD)') + 
   theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 16, colour = 'black'), 
        axis.text.y = element_text(size = 16, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(breaks = c(0, 50000, 100000, 150000, 200000, 250000, 300000, 350000), labels = c( "0", "50", "100", "150", "200", "250","300", "350")) +
 scale_y_continuous(breaks=seq(-4, 4, 1))

```


#perform a chisqr test to see whether the counts in each income bin are different from the population

```{r}
pingSubset[!is.na(income3), .N]
percentIncomeSample <- pingSubset[!is.na(income3), .N, by = .(income, income2, income3)]
percentIncomeSample <- percentIncomeSample%>%arrange(income)
names(percentIncomeSample)[4] <- "Sample"

percentIncomeSample[income ==1, US_pop := .0367*710]
percentIncomeSample[income ==2, US_pop := .0347*710]
percentIncomeSample[income ==3, US_pop := .1087*710]
percentIncomeSample[income ==4, US_pop := .1062*710]
percentIncomeSample[income ==5, US_pop := .097*710]
percentIncomeSample[income ==6, US_pop := .0842*710]
percentIncomeSample[income ==7, US_pop := .2859*710]
percentIncomeSample[income ==8, US_pop := .1337*710]
percentIncomeSample[income ==9, US_pop := .0569*710]
percentIncomeSample[income ==10, US_pop := .0261*710]
percentIncomeSample[income ==11, US_pop := .014*710]
percentIncomeSample[income ==12, US_pop := .016*710]


sum(percentIncomeSample[, US_pop])
sum(percentIncomeSample[, Sample])

percentIncomeSample$income2 <-  as.factor(percentIncomeSample$income)
percentIncomeSample$US_pop <- round(percentIncomeSample$US_pop)

#create a table
c(percentIncomeSample$Sample, percentIncomeSample$US_pop)
incomeValues <- matrix(c(percentIncomeSample$Sample, percentIncomeSample$US_pop), ncol = 12, byrow = TRUE)
colnames(incomeValues) <- c(1:12)
rownames(incomeValues) <- c("Sample", "US_pop")

#perform a chisqr
#doesn't come from US population
income_x <- chisq.test(incomeValues)
income_x$observed 
income_x$expected 
 
```

#histogram

```{r}
mySampleRep <- rep("Sample", 710)
us_sample_rep <- rep("us_pop", 710)
sample <- c(mySampleRep, us_sample_rep)
incomeDt<- data.table(sample = c(sample))

incomeValues

incomeDt[,income := c(rep(1,22), rep(2, 15), rep(3, 47), rep(4,38), rep(5, 47), rep(6,45), rep(7,201), rep(8,156), rep(9,73), rep(10,28), rep(11,13), rep(12, 25), rep(1,26), rep(2,25), rep(3,77), rep(4,75), rep(5,69), rep(6,60), rep(7,203), rep(8,95), rep(9,40), rep(10,19), rep(11,10), rep(12, 11))]
incomeValues
incomeDt[, .N,by = .(sample, income)]

toMerge<- pingSubset[, .N, by =.(income, income3)]
toMerge<- toMerge%>%arrange(income)
incomeDt <- left_join(incomeDt, toMerge)

glimpse(incomeDt)

incomeDt[sample == "us_pop",sample := "United States Population"]
names(incomeDt)[1] <- "Income"

densityplot(~Income, group = sample, data = incomeDt, auto.key = TRUE)

#density plot
ggplot(incomeDt) +
  geom_density(aes(x = Income, color = sample))+
    labs(title = "Income distributions:\nSample vs. United States population", y = "Density") +
    scale_x_continuous(breaks = seq(1,11)) +
  theme(legend.title=element_blank())

#density plot
glimpse(incomeDt)

density <- ggplot(incomeDt) +
  geom_density(aes(x = Income, fill = sample), alpha = 0.5)+
  scale_x_continuous(breaks = seq(1,12)) +
  labs(title = "", y = "Density", x = "Income (thousands, USD)") +
  theme(legend.title=element_blank()) +
      scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12), labels = c( "4.5", "7.5", "15", "25", "35", "45","75", "125","175", "225", "275", "325")) +
geom_vline(xintercept = 3.96, yintercept = 0, size = 1)  +
  theme(plot.caption = element_text(hjust = 0.5, size  = 10)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 15, colour = 'black'), 
        axis.text.y = element_text(size = 15, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank())+
  guides(fill=FALSE)

#histogram2
histogram <- ggplot(incomeDt, aes(Income, fill = sample)) + 
  geom_histogram(breaks=seq(1, 11, by=1),
                 alpha = 0.5, aes(y = ..density..), position = 'identity') +
    scale_x_continuous(breaks = seq(1,11)) +
    labs(title = "Income distribution of sample vs. United States population", y  = 
           "Density") +
  theme(legend.title=element_blank()) +
        scale_x_continuous(breaks = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12), labels = c( "$4,500", "$7,500", "$15,000", "$25,000", "$35,000", "$45,000","$75,000", "$125,000","$175,000", "$225,000", "$275,000", "$325,000")) +
geom_vline(xintercept = 3.96)  +
  guides(fill=FALSE)+  theme(plot.caption = element_text(hjust = 0.5, size  = 10)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 14, colour = 'black'), 
        axis.text.y = element_text(size = 14, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank())+
  guides(fill=FALSE)

incomeHistogram_count <- ggplot(incomeDt, aes(Income, fill = sample)) + 
  geom_histogram(breaks=seq(1, 11, by=1),
                 alpha = 0.5, position = 'identity') +
    scale_x_continuous(breaks = seq(1,11))+
    labs(title = "Income distributions:\nSample vs. United States population", y = "Count") +
  theme(legend.title=element_blank())



```


```{r}

bottom_row <- plot_grid(episodic_z, vocab_z, align = 'h')
plot_grid(density, bottom_row, ncol = 1, rel_heights = c(1, 1.2))
plot_grid(density, episodic_z, vocab_z,align = "hv")

```


```{r}

bottom_row2 <- plot_grid(episodic_residuals, vocab_residuals, align = 'h')
plot_grid(histogram, bottom_row2, ncol = 1, rel_heights = c(1, 1.2))
plot_grid(density, episodic_z, vocab_z,align = "hv")
```


#figure 2b
```{r}

toMerge <- pingSubset[, .(ID, income3)]
dim(toMerge)
AntPostSlopes <- left_join(AntPostSlopes, toMerge)
AntPostSlopes[, .(logIncome3, income3)]


regionImage <- seWithin(data = AntPostSlopes, measurevar = c('volumes_resid'), withinvars = c('region2'),betweenvars = c('income3'), idvar = 'ID')

ggplot(regionImage, aes(income3, volumes_resid, col = region2)) +
    geom_smooth(formula = y ~ log(x), method = 'lm', data = AntPostSlopes)+
  geom_jitter() +
   labs(y = "Adjusted volumes (mm^3; residuals)", x = "Household Income", col = "Region")+
     theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 16, colour = 'black'), 
        axis.text.y = element_text(size = 16, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(breaks = c(0, 50000, 100000, 150000, 200000, 250000, 300000, 350000), labels = c( "0", "50", "100", "150", "200", "250","300", "350")) 



```

#figure 2b
```{r}

vol_interaction <- ggplot(AntPostSlopes, aes(income3, volumes_resid, col = region2)) +
    geom_smooth(formula = y ~ log(x), method = 'lm', data = AntPostSlopes)+
  #geom_quasirandom(alpha = 0.2) +
   labs(y = "Adjusted volumes \n(mm^3; residuals)", x = "Income (thousands, USD)", col = "Region")+
     theme(legend.position = "none", plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 16, colour = 'black'), 
        axis.text.y = element_text(size = 16, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) +
    scale_x_continuous(breaks = c(0, 50000, 100000, 150000, 200000, 250000, 300000, 350000), labels = c( "0", "50", "100", "150", "200", "250","300", "350")) #+
  #coord_cartesian(ylim = c(-1000, 1000))


place_holder_figure <- ggplot(AntPostSlopes, aes(income3, volumes_resid, col = region2))

```

#figure 3c&d

```{r}
toMerge <- pingSubset[, .(ID, TBX_ibam_scr_residuals, TBX_VOCAB_THETA_residuals)]
toMerge[, mean(TBX_VOCAB_THETA_residuals, na.rm=TRUE)]
AntPostSlopes <- left_join(AntPostSlopes, toMerge)
AntPostSlopes[region == "combinedPosteriorNewRO", region_name := "Posterior"]
AntPostSlopes[region == "combinedHeadNewRO", region_name := "Anterior"]

episodic_vols <- ggplot(AntPostSlopes, aes(volume, TBX_ibam_scr_residuals, col = region_name)) +
    geom_smooth(formula = y ~ x, method = 'lm', data = AntPostSlopes)+
  #geom_quasirandom(alpha = 0.2) +
   labs(y = "Adjusted episodic memory\n performance", x = "Volume (mm^3)", col = " ")+
     #theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 16, colour = 'black'), 
        axis.text.y = element_text(size = 16, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank()) +
    guides(fill=FALSE)


vocab_vols <- ggplot(AntPostSlopes, aes(volume, TBX_VOCAB_THETA_residuals, col = region_name)) +
    geom_smooth(formula = y ~ x, method = 'lm', data = AntPostSlopes)+
  #geom_quasirandom(alpha = 0.2) +
   labs(y = "Adjusted vocabulary\n performance", x = "Volume (mm^3)", col = " ")+
     #theme(plot.caption = element_text(hjust = -.2, size  = 12)) +
  theme(legend.position = "none", panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "white", colour = NA),
        axis.line.x = element_line(size = 1, linetype = "solid", colour = "black"), 
        axis.line.y = element_line(size = 1, linetype = "solid", colour = "black"),
        axis.text.x = element_text(size = 16, colour = 'black'), 
        axis.text.y = element_text(size = 16, colour = 'black'), 
        plot.title = element_text(size = 15, hjust = 0.5),
        text = element_text(size = 15), panel.spacing.x = unit(1, "lines"),
        legend.key = element_blank(), legend.key.height = unit(2, 'line')) 

bottom_row_vols <- plot_grid(episodic_vols, vocab_vols, align = 'h')
top_row_figs <- plot_grid(place_holder_figure, vol_interaction, align = "h")
plot_grid(top_row_figs, bottom_row_vols, ncol = 1, rel_heights = c(1, 1))


pingSubset[, .(episodic_zscores, TBX_ibam_scr_residuals, TBX_ibam_scr_residualsCheck)]  
pingSubset[!is.na(TBX_ibam_scr), TBX_ibam_scr_residualsCheck := residuals(lm(TBX_ibam_scr ~ AgeC + GenderEC))]
pingSubset[, sum(episodic_zscores, na.rm=TRUE)]


```


```{r}

pingSubset[, ]

grep(names(pingSubset), pattern = "head", value = TRUE)
grep(names(pingSubset), pattern = "tail", value = TRUE)


right.headNewRO
left.headNewRO
right.tailNewRO
left.tailNewRO

pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO), .(left.headNewRO)]


summary(lm(TBX_ibam_scr ~ left.headNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO),]))
summary(lm(TBX_ibam_scr ~ right.headNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO),]))

summary(lm(TBX_VOCAB_THETA ~ left.headNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO),]))
summary(lm(TBX_VOCAB_THETA ~ right.headNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO),]))

summary(lm(TBX_ibam_scr ~ left.tailNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO),]))
summary(lm(TBX_ibam_scr ~ right.tailNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO),]))

summary(lm(TBX_VOCAB_THETA ~ left.tailNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO)  & !is.na(combinedPosteriorNewRO),]))
summary(lm(TBX_VOCAB_THETA ~ right.tailNewRO + AgeC + logIncome3 + GenderEC + DeviceSerialNumber, data = pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO),]))
```


#table 1

```{r}
pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO), .N]
pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO), mean(Age)]
pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO), range(Age)]
pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO), .N, by = Gender]

pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO), range(income3)]

pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO), range(income3)]

pingSubset[!is.na(combinedPosteriorNewRO) & !is.na(combinedHeadNewRO), .N, by = ethnicity]


#dummy code many levels of a factor

class(pingSubset$DeviceSerialNumber)
pingSubset$DeviceSerialNumberFactor <- as.factor(pingSubset$DeviceSerialNumber)
pingSubset[, .(DeviceSerialNumber, DeviceSerialNumberFactor)]

contr.sum(7)

contrasts(pingSubset$DeviceSerialNumberFactor) = contr.sum(7)

pingSubset[, .(DeviceSerialNumber, DeviceSerialNumberFactor)]

relevel(pingSubset$DeviceSerialNumberFactor,ref = "f")


library(car)
Anova(aov(combinedPosteriorNewRO ~ AgeC + logIncome3 + DeviceSerialNumber + GenderEC, data = pingSubset[!is.na(combinedHeadNewRO)]), type = 3)


pingSubset[!is.na(combinedHeadNewRO) & !is.na(combinedPosteriorNewRO) & !is.na(TBX_VOCAB_THETA), .N]
anova(lm(combinedHeadNewRO ~ logIncome3+DeviceSerialNumberFactor+AgeC, data=pingSubset,contrasts(pingSubset$DeviceSerialNumberFactor) = contr.sum(7)))

```

#relative distribution of subfields along head/tail
```{r}
grep(names(pingFull), pattern  = "ca1", value  = T)
pingFull[, .(right.whole.ca1, right.tail.ca1, right.ca1.head)]

pingFull[right.ca1.head/right.tail.ca1]

grep(names(pingFull), pattern = "ratio", value = T)

pingFull[, ratioHead_ca1 := left.head/left.ca1.head]
pingFull[, ratioTail_ca1 := left.tail/left.tail.ca1]



pingFull[, mean(ratioHead_ca1, na.rm=T)]
pingFull[, mean(ratioTail_ca1, na.rm=T)]

t.test(pingFull$ratioCa1Dg.left.head, pingFull$ratioCA1Dg.left.tail)




```





#are there memory differences after controlling for attention?
```{r}
grep(names(pingFull), pattern = "attention", value =T)


summary(lm(TBX_ibam_scr ~ Age , data = pingFull))
summary(lm(TBX_ibam_scr ~ Age , data = pingFull[Age > 20]))

summary(lm(TBX_ibam_scr ~ Age + TBX_attention_score, data = pingFull))
summary(lm(TBX_ibam_scr ~ Age + TBX_attention_score, data = pingFull[Age < 20 & logIncome3 > 9]))

summary(lm(TBX_ibam_scr  ~ Age , data = pingFull[Age > 13]))
summary(lm(TBX_ibam_scr  ~ Age + TBX_flanker_score, data = pingFull[Age > 13]))
summary(lm(TBX_ibam_scr  ~ Age + TBX_attention_score, data = pingFull[Age > 13]))


```

